<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ê¸°</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#F4F5F7;--white:#FFF;--black:#191F28;--g1:#333D4B;--g2:#4E5968;--g3:#8B95A1;--g4:#B0B8C1;--g5:#D1D6DB;--g6:#E5E8EB;--g7:#F2F4F6;
--blue:#3182F6;--blue-bg:#EBF4FF;--coral:#FF6B6B;--coral-bg:#FFF0F0;--green:#00C471;--green-bg:#E8FAF0;--purple:#7B61FF;--purple-bg:#F0EDFF;--orange:#FF9F43;--orange-bg:#FFF5EB;--teal:#22B8CF;--teal-bg:#E3FAFC;
--sh:0 2px 8px rgba(0,0,0,0.04);--sh2:0 4px 16px rgba(0,0,0,0.06);
--r:20px;--rm:16px;--rs:12px;--rx:10px;
}
body{font-family:'Noto Sans KR',-apple-system,sans-serif;background:var(--bg);color:var(--black);line-height:1.6;-webkit-font-smoothing:antialiased}
.wrap{max-width:1080px;margin:0 auto;padding:0 24px 60px}

/* Header */
.hdr{padding:32px 0 12px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--bg);z-index:100}
.hdr h1{font-size:26px;font-weight:900;letter-spacing:-0.5px}
.hdr-badge{display:flex;align-items:center;gap:6px;padding:7px 14px;background:var(--blue-bg);border-radius:100px;font-size:12px;font-weight:700;color:var(--blue)}
.hdr-badge .dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:bk 1.5s infinite}
@keyframes bk{0%,100%{opacity:1}50%{opacity:.3}}

/* Top cards scroll */
.top-scroll{display:flex;gap:12px;overflow-x:auto;padding:8px 0 16px;-webkit-overflow-scrolling:touch}
.top-scroll::-webkit-scrollbar{display:none}
.t-card{min-width:150px;padding:20px 18px;border-radius:var(--r);text-align:center;box-shadow:var(--sh2);flex-shrink:0;transition:transform .2s;cursor:default}
.t-card:hover{transform:translateY(-3px)}
.t-card .t-icon{font-size:36px;margin-bottom:10px}
.t-card .t-label{font-size:13px;font-weight:700;color:var(--g1)}
.t-card .t-sub{font-size:11px;color:var(--g3);margin-top:3px;font-weight:500}

/* 2-col layout for wide screens */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:760px){.grid2{grid-template-columns:1fr}}

/* Card */
.card{background:var(--white);border-radius:var(--r);padding:24px;margin-top:14px;box-shadow:var(--sh);transition:box-shadow .3s}
.card:hover{box-shadow:var(--sh2)}
.card-top{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.c-icon{width:44px;height:44px;border-radius:var(--rs);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.c-icon.blue{background:var(--blue-bg)}.c-icon.coral{background:var(--coral-bg)}.c-icon.green{background:var(--green-bg)}.c-icon.purple{background:var(--purple-bg)}.c-icon.orange{background:var(--orange-bg)}.c-icon.teal{background:var(--teal-bg)}
.c-title{font-size:17px;font-weight:800;letter-spacing:-.3px}
.c-desc{font-size:13px;color:var(--g3)}

/* Form */
label{font-size:13px;font-weight:600;color:var(--g2);display:block;margin-bottom:5px}
input[type=text],input[type=password],textarea,select{width:100%;padding:12px 14px;background:var(--g7);border:1.5px solid transparent;border-radius:var(--rx);font-size:15px;color:var(--black);font-family:inherit;transition:all .2s;-webkit-appearance:none}
input::placeholder,textarea::placeholder{color:var(--g4);font-weight:400}
input:focus,textarea:focus,select:focus{outline:none;border-color:var(--blue);background:var(--white);box-shadow:0 0 0 3px rgba(49,130,246,.1)}
textarea{resize:vertical;min-height:72px}
select{cursor:pointer;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%238B95A1' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:34px}
.row{display:grid;gap:10px}.r2{grid-template-columns:1fr 1fr}.r3{grid-template-columns:1fr 1fr 1fr}.r4{grid-template-columns:1fr 1fr 1fr 1fr}.r5{grid-template-columns:1fr 1fr 1fr 1fr 1fr}
@media(max-width:600px){.r4,.r5{grid-template-columns:1fr 1fr}}
.stu-id{font-size:14px;font-weight:800;color:var(--blue);background:var(--blue-bg);padding:10px 16px;border-radius:var(--rx);text-align:center;margin-top:8px;letter-spacing:1px}

/* Btn */
.btn{padding:14px 24px;border:none;border-radius:var(--rs);font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;transition:all .2s;display:inline-flex;align-items:center;justify-content:center;gap:8px}
.btn:active{transform:scale(.97)}
.btn-blue{background:var(--blue);color:#fff}.btn-blue:hover{background:#2272E6}
.btn-blue:disabled{background:var(--g6);color:var(--g4);cursor:not-allowed;transform:none}
.btn-green{background:var(--green);color:#fff}.btn-green:hover{background:#00B065}
.btn-purple{background:var(--purple);color:#fff}.btn-purple:hover{background:#6B50EE}
.btn-ghost{background:var(--g7);color:var(--g1);font-weight:600}.btn-ghost:hover{background:var(--g6)}
.btn-sm{padding:10px 16px;font-size:13px;border-radius:var(--rx)}
.btn-full{width:100%}

/* API */
.api-row{display:flex;gap:8px;align-items:end}.api-row .f{flex:1}
.api-st{font-size:12px;font-weight:600;margin-top:6px}.api-ok{color:var(--green)}.api-no{color:var(--coral)}

/* Dropzone */
.dz{border:2px dashed var(--g5);border-radius:var(--r);padding:40px 20px;text-align:center;cursor:pointer;transition:all .3s;background:var(--g7)}
.dz:hover,.dz.drag{border-color:var(--blue);background:var(--blue-bg)}
.dz.done{border-color:var(--green);background:var(--green-bg);border-style:solid}
.dz-i{font-size:40px;margin-bottom:10px}
.dz-m{font-size:15px;font-weight:700}
.dz-s{font-size:13px;color:var(--g3);margin-top:4px}
.file-input{display:none}
.f-info{margin-top:10px;padding:12px 14px;background:var(--green-bg);border-radius:var(--rx);font-size:13px;color:var(--green);font-weight:600}

/* Preset */
.presets{display:flex;gap:8px}
.pre{flex:1;padding:14px;border:2px solid var(--g6);border-radius:var(--rs);background:var(--white);cursor:pointer;text-align:center;transition:all .2s}
.pre:hover{border-color:var(--g5);background:var(--g7)}
.pre.on{border-color:var(--ac,var(--blue));background:var(--abg,var(--blue-bg))}
.pre .em{font-size:24px;display:block;margin-bottom:6px}
.pre .tx{font-size:13px;font-weight:700;color:var(--g2)}.pre.on .tx{color:var(--ac,var(--blue))}
.ptags{display:flex;gap:6px;align-items:center;margin-top:12px;flex-wrap:wrap}
.ptag{padding:6px 14px;border-radius:100px;font-size:12px;font-weight:700}
.pt1{background:var(--blue-bg);color:var(--blue)}.pt2{background:var(--purple-bg);color:var(--purple)}.pt3{background:var(--g7);color:var(--g3)}
.pt-a{color:var(--g4);font-size:12px}

/* KW */
.kws{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
.kw{padding:8px 16px;border:1.5px solid var(--g6);border-radius:100px;font-size:13px;font-weight:500;color:var(--g2);cursor:pointer;transition:all .2s;user-select:none;background:var(--white)}
.kw:hover{border-color:var(--g4)}.kw.on{border-color:var(--blue);background:var(--blue-bg);color:var(--blue);font-weight:600}

/* Progress */
.pw{margin:16px 0;display:none}
.ptr{width:100%;height:6px;background:var(--g6);border-radius:3px;overflow:hidden}
.pfl{height:100%;background:linear-gradient(90deg,var(--blue),var(--purple));border-radius:3px;transition:width .6s;width:0}
.ptx{text-align:center;font-size:14px;color:var(--g3);margin-top:10px;font-weight:600}

/* Tabs */
.tabs{display:flex;gap:4px;background:var(--g7);border-radius:var(--rs);padding:4px;margin-bottom:20px;overflow-x:auto}
.tab{padding:11px 16px;cursor:pointer;font-size:13px;font-weight:500;color:var(--g3);border-radius:var(--rx);white-space:nowrap;transition:all .2s;text-align:center;flex:1}
.tab:hover{color:var(--g2)}.tab.on{background:var(--white);color:var(--black);font-weight:700;box-shadow:var(--sh)}
.tc{display:none}.tc.on{display:block}

/* Report */
.rb{background:var(--g7);border-radius:var(--rs);padding:18px;margin-bottom:10px}
.rb h4{font-size:14px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.rb p{font-size:14px;color:var(--g2);line-height:1.75}
.opt{border-radius:var(--rs);padding:18px;margin:10px 0;background:var(--white);box-shadow:var(--sh);border:1px solid var(--g6);transition:all .3s}
.opt:hover{box-shadow:var(--sh2);transform:translateY(-1px)}
.oh{font-weight:700;font-size:14px;margin-bottom:8px;display:flex;align-items:center;gap:8px}
.ob{font-size:13px;color:var(--g2);line-height:1.8;white-space:pre-wrap}
.of{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
.of span{font-size:12px;color:var(--g3);font-weight:500}
.badge{display:inline-flex;padding:4px 10px;border-radius:100px;font-size:11px;font-weight:700}
.b-bl{background:var(--blue-bg);color:var(--blue)}.b-pu{background:var(--purple-bg);color:var(--purple)}
.b-gr{background:var(--green-bg);color:var(--green)}.b-co{background:var(--coral-bg);color:var(--coral)}
.b-or{background:var(--orange-bg);color:var(--orange)}.b-gy{background:var(--g7);color:var(--g3)}
.cg{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:600px){.cg{grid-template-columns:1fr}}
.ci{padding:16px;border-radius:var(--rs);background:var(--white);box-shadow:var(--sh);border:1px solid var(--g6)}
.ci strong{font-size:13px;display:block;margin-bottom:8px}
.ci p{font-size:12px;color:var(--g2);line-height:1.65;margin:4px 0}
.tbl{width:100%;border-collapse:separate;border-spacing:0;font-size:13px;border-radius:var(--rx);overflow:hidden;border:1px solid var(--g6)}
.tbl th{padding:10px 14px;background:var(--g7);color:var(--g2);font-weight:700;text-align:left}
.tbl td{padding:10px 14px;border-top:1px solid var(--g6);color:var(--g2)}
.tbl tr:hover td{background:var(--g7)}

/* Student list */
.sl{max-height:240px;overflow-y:auto;border-radius:var(--rx);margin-top:10px}
.si{padding:12px 4px;display:flex;justify-content:space-between;align-items:center;font-size:14px;border-bottom:1px solid var(--g6)}
.si:last-child{border:none}
.si .num{font-weight:800;color:var(--blue);margin-right:8px;font-size:13px;background:var(--blue-bg);padding:3px 8px;border-radius:6px}
.si .meta{color:var(--g3);font-size:12px;font-weight:500}

.actions{display:flex;gap:10px;flex-wrap:wrap;margin:16px 0}
.result-section{display:none}
.hidden{display:none}
@media print{body{background:#fff}.no-print{display:none!important}.card{box-shadow:none;border:1px solid #eee}}
</style>
</head>
<body>
<div class="wrap">

<div class="hdr">
<h1>ğŸ“Š ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ê¸°</h1>
<div class="hdr-badge"><span class="dot"></span>AI Powered</div>
</div>

<!-- Flow Steps -->
<div class="top-scroll no-print">
<div class="t-card" style="background:linear-gradient(135deg,#E8F0FE,#D2E3FC)"><div class="t-icon"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><rect x="6" y="4" width="20" height="24" rx="3" fill="#4285F4" opacity=".15"/><rect x="8" y="6" width="16" height="20" rx="2" fill="#4285F4" opacity=".3"/><path d="M12 14h8M12 18h6" stroke="#1A73E8" stroke-width="1.5" stroke-linecap="round"/><circle cx="22" cy="24" r="5" fill="#1A73E8"/><path d="M20.5 24l1 1 2-2" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div class="t-label">PDF ì—…ë¡œë“œ</div><div class="t-sub">ìƒê¸°ë¶€ ë„£ê¸°</div></div>
<div class="t-card" style="background:linear-gradient(135deg,#F3E8FF,#E9D5FF)"><div class="t-icon"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><rect x="4" y="8" width="24" height="16" rx="4" fill="#7C3AED" opacity=".15"/><circle cx="12" cy="16" r="3" fill="#7C3AED" opacity=".4"/><circle cx="20" cy="16" r="3" fill="#7C3AED" opacity=".4"/><path d="M10 13c2-2 8-2 12 0" stroke="#7C3AED" stroke-width="1.3" stroke-linecap="round"/><path d="M10 19c2 2 8 2 12 0" stroke="#7C3AED" stroke-width="1.3" stroke-linecap="round"/></svg></div><div class="t-label">AI ë¶„ì„</div><div class="t-sub">Claude ì—°ë™</div></div>
<div class="t-card" style="background:linear-gradient(135deg,#D1FAE5,#A7F3D0)"><div class="t-icon"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><rect x="5" y="4" width="22" height="24" rx="3" fill="#059669" opacity=".2"/><path d="M10 12h12M10 16h10M10 20h8" stroke="#059669" stroke-width="1.5" stroke-linecap="round"/><path d="M22 18l-2 8h8l-2-8" fill="#059669" opacity=".3"/><circle cx="24" cy="22" r="1" fill="#059669"/></svg></div><div class="t-label">PDF ë³´ê³ ì„œ</div><div class="t-sub">ë°”ë¡œ í”„ë¦°íŠ¸</div></div>
<div class="t-card" style="background:linear-gradient(135deg,#FFF7ED,#FED7AA)"><div class="t-icon"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><rect x="4" y="6" width="24" height="20" rx="3" fill="#EA580C" opacity=".15"/><path d="M4 12h24M12 6v20M20 6v20" stroke="#EA580C" stroke-width="1.2" opacity=".3"/><rect x="13" y="14" width="6" height="4" rx="1" fill="#EA580C" opacity=".5"/></svg></div><div class="t-label">ì—‘ì…€ ì €ì¥</div><div class="t-sub">ëˆ„ì  ê´€ë¦¬</div></div>
<div class="t-card" style="background:linear-gradient(135deg,#FFF1F2,#FECDD3)"><div class="t-icon"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><path d="M6 24V10a4 4 0 014-4h12a4 4 0 014 4v8a4 4 0 01-4 4H12l-6 6v-4z" fill="#E11D48" opacity=".15"/><circle cx="12" cy="14" r="1.5" fill="#E11D48" opacity=".5"/><circle cx="16" cy="14" r="1.5" fill="#E11D48" opacity=".5"/><circle cx="20" cy="14" r="1.5" fill="#E11D48" opacity=".5"/></svg></div><div class="t-label">ìƒë‹´ ê°€ì´ë“œ</div><div class="t-sub">ì¦‰ì‹œ í™œìš©</div></div>
<div class="t-card" style="background:linear-gradient(135deg,#E0F2FE,#BAE6FD)"><div class="t-icon"><svg width="32" height="32" viewBox="0 0 32 32" fill="none"><path d="M8 26V8a2 2 0 012-2h8l6 6v14a2 2 0 01-2 2H10a2 2 0 01-2-2z" fill="#0284C7" opacity=".15"/><path d="M18 6v6h6" stroke="#0284C7" stroke-width="1.3"/><path d="M12 16l2 2 4-4" stroke="#0284C7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 22h8" stroke="#0284C7" stroke-width="1.3" stroke-linecap="round"/></svg></div><div class="t-label">ì„¸íŠ¹ ì˜ˆì‹œ</div><div class="t-sub">1ì•ˆ / 2ì•ˆ</div></div>
</div>

<!-- 2-col grid for wide screens -->
<div class="grid2">

<!-- API -->
<div class="card no-print">
<div class="card-top"><div class="c-icon blue"><svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 2a4 4 0 014 4v2h1a3 3 0 013 3v8a3 3 0 01-3 3H7a3 3 0 01-3-3v-8a3 3 0 013-3h1V6a4 4 0 014-4zm0 2a2 2 0 00-2 2v2h4V6a2 2 0 00-2-2z" fill="#3182F6"/></svg></div><div><div class="c-title">API ì—°ê²°</div><div class="c-desc">Anthropic API Key</div></div></div>
<div class="api-row"><div class="f"><input type="password" id="apiKey" placeholder="sk-ant-..."/></div><button class="btn btn-blue btn-sm" onclick="saveKey()">ì €ì¥</button></div>
<div style="margin-top:8px"><label>ëª¨ë¸ ì„ íƒ</label><select id="modelSel" style="font-size:13px">
<option value="claude-sonnet-4-5-20250514">Sonnet 4.5 (ì¶”ì²œ)</option>
<option value="claude-sonnet-4-20250514">Sonnet 4</option>
<option value="claude-haiku-4-5-20251001">Haiku 4.5 (ë¹ ë¦„/ì €ë ´)</option>
</select></div>
<div class="api-st" id="apiSt"></div>
</div>

<!-- PDF -->
<div class="card no-print">
<div class="card-top"><div class="c-icon coral"><svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M6 2h9l5 5v13a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2z" fill="#FF6B6B" opacity=".2"/><path d="M14 2v5h5" stroke="#FF6B6B" stroke-width="1.5"/><path d="M9 13l3 3 3-3M12 16V9" stroke="#FF6B6B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><div><div class="c-title">ìƒê¸°ë¶€ ì—…ë¡œë“œ</div><div class="c-desc">PDF ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­</div></div></div>
<div class="dz" id="dz" onclick="document.getElementById('fi').click()">
<div class="dz-i">ğŸ“</div><div class="dz-m">PDF íŒŒì¼ ì„ íƒ</div><div class="dz-s">1, 2í•™ë…„ ìƒê¸°ë¶€ í¬í•¨</div>
</div>
<input type="file" id="fi" class="file-input" accept=".pdf"/>
<div id="fI" class="hidden f-info"></div>
</div>

</div>

<!-- Student Info -->
<div class="card no-print">
<div class="card-top"><div class="c-icon green">ğŸ‘¤</div><div><div class="c-title">í•™ìƒ ì •ë³´</div><div class="c-desc">í•™ë…„ë°˜ë²ˆí˜¸ Â· ì´ë¦„ Â· ì§„ë¡œ Â· ë™ì•„ë¦¬</div></div></div>
<div class="row r5">
<div><label>í•™ë…„</label><select id="sGrade"><option value="3">3í•™ë…„</option></select></div>
<div><label>ë°˜</label><select id="sClass"><option value="">ì„ íƒ</option></select></div>
<div><label>ë²ˆí˜¸</label><select id="sNo"><option value="">ì„ íƒ</option></select></div>
<div><label>ì´ë¦„</label><input type="text" id="sName" placeholder="í™ê¸¸ë™"/></div>
<div><label>í¬ë§ ì§„ë¡œ</label><input type="text" id="sCareer" placeholder="ê°„í˜¸ì‚¬"/></div>
</div>
<div class="row r2" style="margin-top:10px">
<div><label>ë™ì•„ë¦¬ëª…</label><input type="text" id="sClub" placeholder="ê³¼í•™íƒêµ¬ë°˜"/></div>
<div><label>í•™ë²ˆ ë¯¸ë¦¬ë³´ê¸°</label><div class="stu-id" id="stuIdPreview">3 - -- - --</div></div>
</div>
</div>

<!-- Priority + KW side by side on wide -->
<div class="grid2">

<div class="card no-print">
<div class="card-top"><div class="c-icon purple">ğŸ¯</div><div><div class="c-title">ìš°ì„ ìˆœìœ„ ì„¤ì •</div><div class="c-desc">ë³´ê³ ì„œ ì‘ì„± ë°©í–¥</div></div></div>
<div class="presets">
<div class="pre" onclick="setP('top')" id="pTop" style="--ac:#3182F6;--abg:#EBF4FF"><span class="em">ğŸ†</span><span class="tx">1~2ë“±ê¸‰</span></div>
<div class="pre" onclick="setP('mid')" id="pMid" style="--ac:#7B61FF;--abg:#F0EDFF"><span class="em">ğŸ¯</span><span class="tx">3~5ë“±ê¸‰</span></div>
<div class="pre" onclick="setP('cus')" id="pCus" style="--ac:#4E5968;--abg:#F2F4F6"><span class="em">âš™ï¸</span><span class="tx">ì§ì ‘ì„¤ì •</span></div>
</div>
<div id="cusP" class="hidden" style="margin-top:10px">
<div class="row r3">
<div><label>1ìˆœìœ„</label><select id="p1" onchange="upP()"><option>í•™ì—…</option><option>ì§„ë¡œ</option><option>ê³µë™ì²´</option></select></div>
<div><label>2ìˆœìœ„</label><select id="p2" onchange="upP()"><option>ì§„ë¡œ</option><option>í•™ì—…</option><option>ê³µë™ì²´</option></select></div>
<div><label>3ìˆœìœ„</label><select id="p3" disabled><option>ê³µë™ì²´</option></select></div>
</div>
</div>
<div class="ptags" id="ptags">
<span class="ptag pt1" id="t1">1ìˆœìœ„ í•™ì—…</span><span class="pt-a">â†’</span>
<span class="ptag pt2" id="t2">2ìˆœìœ„ ì§„ë¡œ</span><span class="pt-a">â†’</span>
<span class="ptag pt3" id="t3">3ìˆœìœ„ ê³µë™ì²´</span>
</div>
</div>

<div class="card no-print">
<div class="card-top"><div class="c-icon orange">ğŸ·ï¸</div><div><div class="c-title">í‚¤ì›Œë“œ ì„ íƒ</div><div class="c-desc">ë³´ê³ ì„œì— ë°˜ì˜í•  í‚¤ì›Œë“œ</div></div></div>
<div class="kws" id="kwG"></div>
<label style="margin-top:6px">ì§ì ‘ ì…ë ¥</label>
<input type="text" id="kwC" placeholder="ESGê²½ì˜, ë¹…ë°ì´í„° (ì‰¼í‘œ êµ¬ë¶„)"/>
</div>

</div>

<!-- Memo -->
<div class="card no-print">
<div class="card-top"><div class="c-icon teal">ğŸ’¡</div><div><div class="c-title">ìƒë‹´ ë©”ëª¨</div><div class="c-desc">ì„ íƒ Â· ì¶”ê°€ ì •ë³´</div></div></div>
<textarea id="memo" placeholder="í•™ìƒ íŠ¹ì´ì‚¬í•­, ê°•ì¡° í¬ì¸íŠ¸, ë³´ì™„í•  ì  ë“±"></textarea>
</div>

<!-- Go -->
<button class="btn btn-blue btn-full no-print" id="goBtn" onclick="analyze()" disabled style="margin-top:14px;padding:16px;font-size:16px;border-radius:var(--r)">ğŸ” AI ì¢…í•© ë¶„ì„ ì‹œì‘</button>
<div class="pw no-print" id="pW"><div class="ptr"><div class="pfl" id="pF"></div></div><div class="ptx" id="pT"></div></div>
<div id="errMsg" style="display:none;margin:10px 0;padding:14px 18px;background:#FFF0F0;border:1.5px solid #FF6B6B;border-radius:12px;color:#FF6B6B;font-size:14px;font-weight:600" class="no-print"></div>

<!-- Results -->
<div class="result-section" id="resS">
<div class="card">
<div class="tabs">
<div class="tab on" onclick="st('ov')">ğŸ“Š ì¢…í•©</div>
<div class="tab" onclick="st('jh')">ğŸ“ ììœ¨Â·ì§„ë¡œÂ·í–‰ë°œ</div>
<div class="tab" onclick="st('se')">ğŸ¯ ì„¸íŠ¹</div>
<div class="tab" onclick="st('cl')">ğŸ« ë™ì•„ë¦¬</div>
<div class="tab" onclick="st('co')">ğŸ’¬ ìƒë‹´</div>
</div>
<div class="tc on" id="tc-ov"></div>
<div class="tc" id="tc-jh"></div>
<div class="tc" id="tc-se"></div>
<div class="tc" id="tc-cl"></div>
<div class="tc" id="tc-co"></div>
</div>
<div class="actions no-print">
<button class="btn btn-green" onclick="dlPDF()" style="flex:1">ğŸ“„ PDF ë³´ê³ ì„œ</button>
<button class="btn btn-purple" onclick="dlXL()" style="flex:1">ğŸ“Š ì—‘ì…€ ì €ì¥</button>
<button class="btn btn-ghost" onclick="next()" style="flex:1">â¡ï¸ ë‹¤ìŒ í•™ìƒ</button>
</div>
</div>

<!-- Student Summary -->
<div class="card no-print">
<div class="card-top"><div class="c-icon green">ğŸ“‹</div><div><div class="c-title">ë¶„ì„ ì™„ë£Œ í•™ìƒ</div><div class="c-desc" id="stuCnt">0ëª… ì™„ë£Œ</div></div></div>
<div class="sl" id="stuL"><div style="padding:20px;color:var(--g4);text-align:center;font-size:14px">ì•„ì§ ë¶„ì„ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</div></div>
<button class="btn btn-purple btn-sm btn-full" onclick="dlAll()" style="margin-top:12px">ğŸ“Š ì „ì²´ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
</div>

</div>

<script>
let pdf='',key='',pri=['í•™ì—…','ì§„ë¡œ','ê³µë™ì²´'],selKW=[],stu={},cur=null;
const KW=['ìê¸°ì£¼ë„í•™ìŠµ','ë¹„íŒì ì‚¬ê³ ','ë°ì´í„°ë¶„ì„','ë¦¬ë”ì‹­','í˜‘ì—…','ë¬¸ì œí•´ê²°','ë°œí‘œë ¥','ë´‰ì‚¬í™œë™','ìœµí•©ì‚¬ê³ ','ì°½ì˜ì„±','ì˜ì‚¬ì†Œí†µ','ê¸€ë¡œë²Œì—­ëŸ‰','ë””ì§€í„¸ë¦¬í„°ëŸ¬ì‹œ','ì—°êµ¬ì—­ëŸ‰','ì§„ë¡œíƒìƒ‰','ë©˜í† ë§','í”„ë¡œì íŠ¸ê¸°íš','ë…ì„œí™œë™'];

(function(){
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
// ë°˜ 01~10
const sc=document.getElementById('sClass');for(let i=1;i<=10;i++){const o=document.createElement('option');o.value=String(i).padStart(2,'0');o.textContent=i+'ë°˜';sc.appendChild(o)}
// ë²ˆí˜¸ 01~30
const sn=document.getElementById('sNo');for(let i=1;i<=30;i++){const o=document.createElement('option');o.value=String(i).padStart(2,'0');o.textContent=i+'ë²ˆ';sn.appendChild(o)}
// í•™ë²ˆ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
['sGrade','sClass','sNo'].forEach(id=>document.getElementById(id).addEventListener('change',updPreview));

const g=document.getElementById('kwG');KW.forEach(k=>{const d=document.createElement('div');d.className='kw';d.textContent=k;d.onclick=()=>{d.classList.toggle('on');d.classList.contains('on')?selKW.push(k):selKW=selKW.filter(x=>x!==k)};g.appendChild(d)});
const sv=localStorage.getItem('sgb_key');if(sv){key=sv;document.getElementById('apiKey').value=sv;apiOk()}
const ss=localStorage.getItem('sgb_stu');if(ss)try{stu=JSON.parse(ss);rStu()}catch(e){}
chk();setP('top');
})();

function getStuId(){
const g=document.getElementById('sGrade').value;
const c=document.getElementById('sClass').value;
const n=document.getElementById('sNo').value;
if(!c||!n)return'';
return g+c+n; // e.g. 30101, 30530, 31024
}
function updPreview(){
const id=getStuId();
const g=document.getElementById('sGrade').value;
const c=document.getElementById('sClass').value;
const n=document.getElementById('sNo').value;
document.getElementById('stuIdPreview').textContent=id?id:`${g} - ${c||'--'} - ${n||'--'}`;
}

function saveKey(){
key=document.getElementById('apiKey').value.trim();
if(!key){document.getElementById('apiSt').innerHTML='<span class="api-no">í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</span>';return}
if(!key.startsWith('sk-ant-')){document.getElementById('apiSt').innerHTML='<span class="api-no">âš ï¸ sk-ant-ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</span>';return}
localStorage.setItem('sgb_key',key);apiOk();chk();
console.log('[saveKey] í‚¤ ì €ì¥ ì™„ë£Œ, ê¸¸ì´:',key.length);
}
function apiOk(){document.getElementById('apiSt').innerHTML='<span class="api-ok">âœ“ ì €ì¥ ì™„ë£Œ</span>'}

const dz=document.getElementById('dz'),fi=document.getElementById('fi');
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('drag')});
dz.addEventListener('dragleave',()=>dz.classList.remove('drag'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('drag');e.dataTransfer.files[0]&&hf(e.dataTransfer.files[0])});
fi.addEventListener('change',e=>e.target.files[0]&&hf(e.target.files[0]));

async function hf(f){
if(f.type!=='application/pdf'){alert('PDFë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');return}
dz.classList.add('done');dz.querySelector('.dz-i').textContent='âœ…';
dz.querySelector('.dz-m').textContent=f.name;dz.querySelector('.dz-s').textContent='ì¶”ì¶œ ì¤‘...';
try{const b=await f.arrayBuffer();const p=await pdfjsLib.getDocument({data:b}).promise;let t='';
for(let i=1;i<=p.numPages;i++){const pg=await p.getPage(i);const tc=await pg.getTextContent();t+=tc.items.map(x=>x.str).join(' ')+'\n'}
pdf=t;
console.log('[PDF] í…ìŠ¤íŠ¸ ì¶”ì¶œ ì™„ë£Œ, ê¸¸ì´:',pdf.length);
if(pdf.length<50){dz.querySelector('.dz-s').textContent='âš ï¸ í…ìŠ¤íŠ¸ê°€ ê±°ì˜ ì¶”ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìŠ¤ìº” PDFì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤';return}
dz.querySelector('.dz-s').textContent=`${p.numPages}p Â· ${pdf.length.toLocaleString()}ì`;
document.getElementById('fI').classList.remove('hidden');
document.getElementById('fI').textContent=`âœ“ ${f.name} Â· ${(f.size/1024).toFixed(0)}KB Â· ${p.numPages}í˜ì´ì§€`;chk()
}catch(e){dz.querySelector('.dz-s').textContent='âœ• '+e.message}}

function setP(t){document.querySelectorAll('.pre').forEach(b=>{b.classList.remove('on');b.style.borderColor='var(--g6)';b.style.background='var(--white)';b.querySelector('.tx').style.color='var(--g2)'});document.getElementById('cusP').classList.add('hidden');
if(t==='top'){pri=['í•™ì—…','ì§„ë¡œ','ê³µë™ì²´'];const el=document.getElementById('pTop');el.classList.add('on');el.style.borderColor='#3182F6';el.style.background='#EBF4FF';el.querySelector('.tx').style.color='#3182F6'}
else if(t==='mid'){pri=['ì§„ë¡œ','í•™ì—…','ê³µë™ì²´'];const el=document.getElementById('pMid');el.classList.add('on');el.style.borderColor='#7B61FF';el.style.background='#F0EDFF';el.querySelector('.tx').style.color='#7B61FF'}
else{const el=document.getElementById('pCus');el.classList.add('on');el.style.borderColor='#4E5968';el.style.background='#F2F4F6';el.querySelector('.tx').style.color='#4E5968';document.getElementById('cusP').classList.remove('hidden');upP()}rPr()}
function upP(){const a=document.getElementById('p1').value,b=document.getElementById('p2').value,c=['í•™ì—…','ì§„ë¡œ','ê³µë™ì²´'].find(x=>x!==a&&x!==b)||'ê³µë™ì²´';document.getElementById('p3').innerHTML=`<option>${c}</option>`;pri=[a,b,c];rPr()}
function rPr(){document.getElementById('t1').textContent='1ìˆœìœ„ '+pri[0];document.getElementById('t2').textContent='2ìˆœìœ„ '+pri[1];document.getElementById('t3').textContent='3ìˆœìœ„ '+pri[2]}
function chk(){
const ready=!!(key&&pdf);
const btn=document.getElementById('goBtn');
btn.disabled=!ready;
console.log('[chk] key:',!!key,'pdf:',!!pdf,'ready:',ready);
if(!ready){
let msg=[];
if(!key)msg.push('API Key í•„ìš”');
if(!pdf)msg.push('PDF ì—…ë¡œë“œ í•„ìš”');
btn.textContent='âš ï¸ '+msg.join(' + ');
}else{
btn.textContent='ğŸ” AI ì¢…í•© ë¶„ì„ ì‹œì‘';
}
}

async function analyze(){
console.log('[analyze] ì‹œì‘');
const sid=getStuId()||'30101';
const nm=document.getElementById('sName').value.trim()||'í•™ìƒ';
const cr=document.getElementById('sCareer').value.trim()||'ë¯¸ì •';
const cl=document.getElementById('sClub').value.trim()||'ë¯¸ì •';
const me=document.getElementById('memo').value.trim();
const kw=[...selKW];const kc=document.getElementById('kwC').value.trim();if(kc)kw.push(...kc.split(',').map(s=>s.trim()).filter(Boolean));

// ì‚¬ì „ ê²€ì¦
if(!key){alert('âŒ API Keyë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”');return}
if(!pdf){alert('âŒ PDFë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”');return}

document.getElementById('pW').style.display='block';document.getElementById('goBtn').disabled=true;
showStatus('ğŸ“„ PDF ë¶„ì„ ì¤‘...',10);

try{
showStatus('ğŸ¤– AI ë¶„ì„ ìš”ì²­ ì¤‘... (30ì´ˆ~1ë¶„ ì†Œìš”)',30);
console.log('[analyze] API í˜¸ì¶œ ì‹œì‘, pdfê¸¸ì´:',pdf.length,'keyì¡´ì¬:',!!key);

const body={model:document.getElementById('modelSel')?.value||'claude-sonnet-4-5-20250514',max_tokens:8000,messages:[{role:'user',content:bp(nm,cr,cl,kw,me)}]};
console.log('[analyze] ìš”ì²­ body model:',body.model);

const r=await fetch('https://api.anthropic.com/v1/messages',{
method:'POST',
headers:{
'Content-Type':'application/json',
'x-api-key':key,
'anthropic-version':'2023-06-01',
'anthropic-dangerous-direct-browser-access':'true'
},
body:JSON.stringify(body)
});

console.log('[analyze] ì‘ë‹µ status:',r.status);

if(!r.ok){
let errMsg='API ì˜¤ë¥˜ ('+r.status+')';
try{const e=await r.json();errMsg=e.error?.message||errMsg;console.log('[analyze] ì—ëŸ¬ ìƒì„¸:',e)}catch(ex){}
throw new Error(errMsg);
}

showStatus('ğŸ“Š ì‘ë‹µ ì²˜ë¦¬ ì¤‘...',70);
const d=await r.json();
console.log('[analyze] ì‘ë‹µ ìˆ˜ì‹ , content blocks:',d.content?.length);
const tx=d.content.map(c=>c.text||'').join('');
console.log('[analyze] í…ìŠ¤íŠ¸ ê¸¸ì´:',tx.length);

showStatus('ğŸ“‹ ë³´ê³ ì„œ ìƒì„± ì¤‘...',90);
cur=pr(tx,nm,cr,cl,sid,kw);
if(cur._err){console.warn('[analyze] JSON íŒŒì‹± ì‹¤íŒ¨, raw ì•ë¶€ë¶„:',tx.substring(0,200))}

stu[sid]={name:nm,career:cr,club:cl,sid,date:new Date().toLocaleDateString('ko-KR'),result:cur};
try{localStorage.setItem('sgb_stu',JSON.stringify(stu))}catch(ex){console.warn('localStorage ì €ì¥ ì‹¤íŒ¨')}
rR(cur);rStu();showStatus('âœ… ë¶„ì„ ì™„ë£Œ!',100);
setTimeout(()=>{document.getElementById('pW').style.display='none';document.getElementById('goBtn').disabled=false},1500);

}catch(e){
console.error('[analyze] ì—ëŸ¬:',e);
showStatus('âŒ ì˜¤ë¥˜: '+e.message,0);
// ì—ëŸ¬ ì•Œë¦¼ë„ í‘œì‹œ
const errDiv=document.getElementById('errMsg');
if(errDiv){errDiv.textContent='âš ï¸ '+e.message;errDiv.style.display='block'}
document.getElementById('goBtn').disabled=false;
document.getElementById('goBtn').textContent='ğŸ” AI ì¢…í•© ë¶„ì„ ì‹œì‘ (ì¬ì‹œë„)';
}}
function showStatus(t,p){document.getElementById('pF').style.width=p+'%';document.getElementById('pT').textContent=t;console.log('[status]',p+'%',t)}
// spëŠ” showStatusë¡œ ëŒ€ì²´ë¨

function bp(nm,cr,cl,kw,me){return`ë‹¹ì‹ ì€ í•œêµ­ ê³ ë“±í•™êµ ìƒê¸°ë¶€ ì „ë¬¸ ë¶„ì„ê°€ì…ë‹ˆë‹¤.
[í•™ìƒ] ì´ë¦„:${nm} ì§„ë¡œ:${cr} ë™ì•„ë¦¬:${cl} í‚¤ì›Œë“œ:${kw.join(',')||'ì—†ìŒ'} ${me?'ë©”ëª¨:'+me:''}
[ìš°ì„ ìˆœìœ„] 1ìˆœìœ„:${pri[0]} 2ìˆœìœ„:${pri[1]} 3ìˆœìœ„:${pri[2]}
[ë°”ì´íŠ¸] ììœ¨:1500 ì§„ë¡œ:2100 ë™ì•„ë¦¬:1500 í–‰ë°œ:1500 (í•œê¸€1ì=3ë°”ì´íŠ¸)
[ìƒê¸°ë¶€]
${pdf.substring(0,15000)}
[ì¶œë ¥: JSONë§Œ. ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ê¸ˆì§€]
{"overview":{"summary":"ìš”ì•½3-4ë¬¸ì¥","strengths":["ê°•ì 1","ê°•ì 2","ê°•ì 3"],"improvements":["ë³´ì™„1","ë³´ì™„2"],"competencies":{"career":{"grade1":"","grade2":"","growth":""},"academic":{"grade1":"","grade2":"","growth":""},"community":{"grade1":"","grade2":"","growth":""},"character":{"grade1":"","grade2":"","growth":""}}},"jarhaeng":{"jayul":{"evaluation":"í‰ê°€","option1":{"title":"${pri[0]}ì¤‘ì‹¬","text":"ì˜ˆì‹œ(1500Bì´ë‚´)","focus":"ì¶”ì²œ","supplement":"ë³´ì™„"},"option2":{"title":"${pri[1]}ì¤‘ì‹¬","text":"ì˜ˆì‹œ(1500Bì´ë‚´)","focus":"ì¶”ì²œ","supplement":"ë³´ì™„"}},"jinro":{"evaluation":"","option1":{"title":"${pri[0]}ì¤‘ì‹¬","text":"(2100B)","focus":"","supplement":""},"option2":{"title":"${pri[1]}ì¤‘ì‹¬","text":"(2100B)","focus":"","supplement":""}},"dongari":{"evaluation":"","option1":{"title":"${pri[0]}ì¤‘ì‹¬","text":"(1500B)","focus":"","supplement":""},"option2":{"title":"${pri[1]}ì¤‘ì‹¬","text":"(1500B)","focus":"","supplement":""}},"hangbal":{"evaluation":"","option1":{"title":"${pri[0]}ì¤‘ì‹¬","text":"(1500B)","focus":"","supplement":""},"option2":{"title":"${pri[1]}ì¤‘ì‹¬","text":"(1500B)","focus":"","supplement":""}}},"setuk":{"direction":"ë°©í–¥","subjects":[{"name":"ê³¼ëª©","theme":"ì£¼ì œ","reason":"ì´ìœ ","keywords":["kw"]}]},"club":{"name":"ë™ì•„ë¦¬","goal":"ëª©í‘œ","monthly":[{"month":"3ì›”","activity":"í™œë™","record":"ê¸°ë¡"},{"month":"4ì›”","activity":"","record":""},{"month":"5ì›”","activity":"","record":""},{"month":"6ì›”","activity":"","record":""},{"month":"7ì›”","activity":"","record":""},{"month":"8ì›”","activity":"","record":""},{"month":"9ì›”","activity":"","record":""},{"month":"10ì›”","activity":"","record":""},{"month":"11ì›”","activity":"","record":""}]},"counsel":{"talk_points":["p1","p2","p3"],"questions":["q1","q2","q3"],"parent_points":["pp1","pp2"],"recommended_activities":["a1","a2","a3"]}}`}

function pr(tx,nm,cr,cl,sid,kw){try{let c=tx.replace(/```json\s*/g,'').replace(/```\s*/g,'').trim();const s=c.indexOf('{'),e=c.lastIndexOf('}');if(s>=0&&e>s)c=c.substring(s,e+1);const o=JSON.parse(c);o._m={nm,cr,cl,sid,kw,pri:[...pri],dt:new Date().toLocaleDateString('ko-KR')};return o}catch(e){return{_m:{nm,cr,cl,sid,kw,pri:[...pri],dt:new Date().toLocaleDateString('ko-KR')},_raw:tx,_err:true}}}

function rR(r){document.getElementById('resS').style.display='block';
if(r._err){document.getElementById('tc-ov').innerHTML=`<div class="rb"><h4>âš  íŒŒì‹± ì‹¤íŒ¨</h4><pre style="white-space:pre-wrap;font-size:12px;color:var(--g3)">${esc(r._raw||'')}</pre></div>`;return}
const m=r._m,ov=r.overview||{},cp=ov.competencies||{};
document.getElementById('tc-ov').innerHTML=`
<div class="rb"><h4>ğŸ“‹ ${m.sid} ${m.nm} ì¢…í•© ë¶„ì„</h4><p>${ov.summary||''}</p></div>
<div class="rb"><h4>ğŸ’ª ê°•ì </h4>${(ov.strengths||[]).map(s=>`<p style="margin:3px 0"><span class="badge b-gr">âœ¦</span> ${s}</p>`).join('')}</div>
<div class="rb"><h4>ğŸ“Œ ë³´ì™„ì </h4>${(ov.improvements||[]).map(s=>`<p style="margin:3px 0"><span class="badge b-co">â†’</span> ${s}</p>`).join('')}</div>
<div class="rb"><h4>ğŸ“Š 4ëŒ€ ì—­ëŸ‰</h4><div class="cg">
${['career','academic','community','character'].map(k=>{const c=cp[k]||{},lb={career:'ì§„ë¡œ',academic:'í•™ì—…',community:'ê³µë™ì²´',character:'ì¸ì„±'};
return`<div class="ci"><strong>${lb[k]}</strong><p><span class="badge b-bl">1í•™ë…„</span> ${c.grade1||'-'}</p><p><span class="badge b-pu">2í•™ë…„</span> ${c.grade2||'-'}</p><p><span class="badge b-gr">ì„±ì¥</span> ${c.growth||'-'}</p></div>`}).join('')}</div></div>`;
document.getElementById('tc-jh').innerHTML=rJH(r.jarhaeng||{});
const se=r.setuk||{};
document.getElementById('tc-se').innerHTML=`<div class="rb"><h4>ğŸ¯ ì„¸íŠ¹ ë°©í–¥</h4><p>${se.direction||''}</p></div>${(se.subjects||[]).map(s=>`<div class="rb"><h4>ğŸ“˜ ${s.name}</h4><p><strong>ì£¼ì œ:</strong> ${s.theme||''}</p><p><strong>ì´ìœ :</strong> ${s.reason||''}</p><p>${(s.keywords||[]).map(k=>`<span class="badge b-bl" style="margin:2px">${k}</span>`).join(' ')}</p></div>`).join('')}`;
const cl=r.club||{};
document.getElementById('tc-cl').innerHTML=`<div class="rb"><h4>ğŸ« ${cl.name||''}</h4><p>${cl.goal||''}</p></div><div class="rb"><h4>ğŸ“… ì›”ë³„ ê³„íš</h4><table class="tbl"><tr><th>ì›”</th><th>í™œë™</th><th>ê¸°ë¡ í¬ì¸íŠ¸</th></tr>${(cl.monthly||[]).map(m=>`<tr><td style="font-weight:700">${m.month}</td><td>${m.activity}</td><td>${m.record}</td></tr>`).join('')}</table></div>`;
const co=r.counsel||{};
document.getElementById('tc-co').innerHTML=`<div class="rb"><h4>ğŸ’¬ ìƒë‹´ í¬ì¸íŠ¸</h4>${(co.talk_points||[]).map(s=>`<p style="margin:3px 0">â€¢ ${s}</p>`).join('')}</div><div class="rb"><h4>â“ ì§ˆë¬¸ ì˜ˆì‹œ</h4>${(co.questions||[]).map(s=>`<p style="margin:3px 0">"${s}"</p>`).join('')}</div><div class="rb"><h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ í•™ë¶€ëª¨</h4>${(co.parent_points||[]).map(s=>`<p style="margin:3px 0">â€¢ ${s}</p>`).join('')}</div><div class="rb"><h4>ğŸš€ ì¶”ì²œ í™œë™</h4>${(co.recommended_activities||[]).map(s=>`<p style="margin:3px 0">âœ¦ ${s}</p>`).join('')}</div>`;
st('ov')}

function rJH(jh){return[{k:'jayul',l:'ììœ¨í™œë™',b:1500},{k:'jinro',l:'ì§„ë¡œí™œë™',b:2100},{k:'dongari',l:'ë™ì•„ë¦¬í™œë™',b:1500},{k:'hangbal',l:'í–‰ë™íŠ¹ì„±ë°ì¢…í•©ì˜ê²¬',b:1500}].map(a=>{
const d=jh[a.k]||{},o1=d.option1||{},o2=d.option2||{},b1=bl(o1.text||''),b2=bl(o2.text||'');
return`<div class="rb"><h4>${a.l} <span class="badge b-gy">${a.b}B</span></h4><p style="margin-bottom:12px">${d.evaluation||''}</p>
<div class="opt"><div class="oh"><span class="badge b-bl">1ì•ˆ</span> ${o1.title||''}</div><div class="ob">${o1.text||''}</div><div class="of"><span>âœ“ ${o1.focus||''}</span><span>â†’ ${o1.supplement||''}</span><span>${b1}/${a.b}B</span></div></div>
<div class="opt"><div class="oh"><span class="badge b-pu">2ì•ˆ</span> ${o2.title||''}</div><div class="ob">${o2.text||''}</div><div class="of"><span>âœ“ ${o2.focus||''}</span><span>â†’ ${o2.supplement||''}</span><span>${b2}/${a.b}B</span></div></div></div>`}).join('')}

function bl(s){return new Blob([s||'']).size}
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function st(id){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('on'));document.querySelectorAll('.tc').forEach(t=>t.classList.remove('on'));document.querySelector(`.tab[onclick="st('${id}')"]`).classList.add('on');document.getElementById('tc-'+id).classList.add('on')}

function dlPDF(){if(!cur)return;const m=cur._m,w=window.open('','_blank');
w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${m.nm} ìƒê¸°ë¶€ ë¶„ì„</title>
<style>body{font-family:'Noto Sans KR',-apple-system,sans-serif;max-width:780px;margin:0 auto;padding:30px;color:#191F28;line-height:1.7;font-size:13px}h1{font-size:1.6em;text-align:center;color:#3182F6;padding-bottom:14px;border-bottom:2px solid #3182F6;font-weight:800}h2{font-size:1.1em;color:#3182F6;margin-top:20px;font-weight:700}.info{background:#F2F4F6;padding:12px 16px;border-radius:12px;margin:14px 0;font-size:12px}.opt{background:#F8F9FA;border-radius:12px;padding:14px;margin:8px 0;border:1px solid #E5E8EB}.opt-t{font-weight:700;color:#3182F6;font-size:12px;margin-bottom:4px}.meta{font-size:11px;color:#8B95A1;margin-top:4px}table{width:100%;border-collapse:collapse;font-size:12px;margin:8px 0}th,td{border:1px solid #E5E8EB;padding:8px}th{background:#F2F4F6;font-weight:700}.footer{text-align:center;margin-top:24px;font-size:11px;color:#8B95A1;border-top:1px solid #E5E8EB;padding-top:10px}@media print{body{padding:10px}}</style></head><body>
<h1>ğŸ“Š ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ ë³´ê³ ì„œ</h1><div class="info"><strong>${m.sid} ${m.nm}</strong> Â· ì§„ë¡œ: ${m.cr} Â· ë™ì•„ë¦¬: ${m.cl} Â· ${m.dt}<br>ìš°ì„ ìˆœìœ„: ${m.pri.map((p,i)=>['â‘ ','â‘¡','â‘¢'][i]+p).join(' â†’ ')}</div>
${document.getElementById('resS').querySelector('.card').innerHTML}<div class="footer">ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ê¸° Â· ${m.dt}</div></body></html>`);
w.document.close();setTimeout(()=>w.print(),500)}

function dlXL(){if(!cur||cur._err)return;const r=cur,m=r._m,wb=XLSX.utils.book_new();
const s1=[['AI ë¶„ì„ - '+m.sid+' '+m.nm,'','','',''],['ì§„ë¡œ:'+m.cr,'ë™ì•„ë¦¬:'+m.cl,m.dt,'ìš°ì„ ìˆœìœ„:'+m.pri.join('â†’'),''],[''],['ì˜ì—­','êµ¬ë¶„','ë‚´ìš©','ë°”ì´íŠ¸','ì œí•œ']];
const jh=r.jarhaeng||{};[{k:'jayul',l:'ììœ¨',lm:1500},{k:'jinro',l:'ì§„ë¡œ',lm:2100},{k:'dongari',l:'ë™ì•„ë¦¬',lm:1500},{k:'hangbal',l:'í–‰ë°œ',lm:1500}].forEach(a=>{
const d=jh[a.k]||{},o1=d.option1||{},o2=d.option2||{};
s1.push([a.l,'í‰ê°€',d.evaluation||'','','']);s1.push([a.l,'1ì•ˆ:'+(o1.title||''),o1.text||'',bl(o1.text||''),a.lm]);
s1.push(['','âœ“ì¶”ì²œ',o1.focus||'','',''],['','â†’ë³´ì™„',o1.supplement||'','','']);
s1.push([a.l,'2ì•ˆ:'+(o2.title||''),o2.text||'',bl(o2.text||''),a.lm]);
s1.push(['','âœ“ì¶”ì²œ',o2.focus||'','',''],['','â†’ë³´ì™„',o2.supplement||'','','']);s1.push([])});
s1.push([],['ì„¸íŠ¹','','','','']);(r.setuk?.subjects||[]).forEach(s=>s1.push([s.name,s.theme,s.reason,(s.keywords||[]).join(','),'']));
const w1=XLSX.utils.aoa_to_sheet(s1);w1['!cols']=[{wch:12},{wch:16},{wch:60},{wch:8},{wch:6}];XLSX.utils.book_append_sheet(wb,w1,'AIë¶„ì„');
const s2=[['ìƒë‹´ê¸°ë¡ - '+m.sid+' '+m.nm,'','',''],['ì˜ì—­','ë°”ì´íŠ¸','ì°¸ê³ ','ì‘ì„±ë€'],['ììœ¨í™œë™','1500','',''],['ì§„ë¡œí™œë™','2100','',''],['ë™ì•„ë¦¬í™œë™','1500','',''],['í–‰ë°œ','1500','','']];
const w2=XLSX.utils.aoa_to_sheet(s2);w2['!cols']=[{wch:16},{wch:8},{wch:40},{wch:60}];XLSX.utils.book_append_sheet(wb,w2,'ì‘ì„±ìš©');
XLSX.writeFile(wb,`ìƒê¸°ë¶€_${m.sid}_${m.nm}.xlsx`)}

function dlAll(){if(!Object.keys(stu).length){alert('ë¶„ì„ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤');return}
const wb=XLSX.utils.book_new();
const l=[['í•™ë²ˆ','ì´ë¦„','ì§„ë¡œ','ë™ì•„ë¦¬','ë¶„ì„ì¼']];
Object.values(stu).sort((a,b)=>a.sid.localeCompare(b.sid)).forEach(s=>l.push([s.sid,s.name,s.career,s.club,s.date]));
const wl=XLSX.utils.aoa_to_sheet(l);wl['!cols']=[{wch:8},{wch:10},{wch:15},{wch:15},{wch:12}];XLSX.utils.book_append_sheet(wb,wl,'ëª©ë¡');
const rc=[['í•™ë²ˆ','ì´ë¦„','ììœ¨(1500B)','ì§„ë¡œ(2100B)','ë™ì•„ë¦¬(1500B)','í–‰ë°œ(1500B)']];
Object.values(stu).sort((a,b)=>a.sid.localeCompare(b.sid)).forEach(s=>rc.push([s.sid,s.name||'','','','','']));
const wr=XLSX.utils.aoa_to_sheet(rc);wr['!cols']=[{wch:8},{wch:10},{wch:50},{wch:60},{wch:50},{wch:50}];XLSX.utils.book_append_sheet(wb,wr,'ìƒë‹´ê¸°ë¡');
Object.values(stu).sort((a,b)=>a.sid.localeCompare(b.sid)).forEach(s=>{
if(!s.result||s.result._err)return;const r=s.result,jh=r.jarhaeng||{};
const d=[[s.sid+' '+s.name],['ì˜ì—­','1ì•ˆ','2ì•ˆ','ì¶”ì²œ','ë³´ì™„']];
['jayul','jinro','dongari','hangbal'].forEach(k=>{const ar=jh[k]||{},o1=ar.option1||{},o2=ar.option2||{};
d.push([{jayul:'ììœ¨',jinro:'ì§„ë¡œ',dongari:'ë™ì•„ë¦¬',hangbal:'í–‰ë°œ'}[k],o1.text||'',o2.text||'',o1.focus||'',o1.supplement||''])});
const ws=XLSX.utils.aoa_to_sheet(d);ws['!cols']=[{wch:10},{wch:50},{wch:50},{wch:25},{wch:25}];XLSX.utils.book_append_sheet(wb,ws,s.sid+'_'+s.name)});
XLSX.writeFile(wb,'ìƒê¸°ë¶€_ì „ì²´.xlsx')}

function rStu(){const l=document.getElementById('stuL'),e=Object.values(stu).sort((a,b)=>a.sid.localeCompare(b.sid));
document.getElementById('stuCnt').textContent=e.length+'ëª… ì™„ë£Œ';
if(!e.length){l.innerHTML='<div style="padding:20px;color:var(--g4);text-align:center;font-size:14px">ì•„ì§ ë¶„ì„ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</div>';return}
l.innerHTML=e.map(s=>`<div class="si"><span><span class="num">${s.sid}</span>${s.name}</span><span class="meta">${s.career} Â· ${s.date} âœ“</span></div>`).join('')}

function next(){document.getElementById('resS').style.display='none';['sName','sCareer','sClub','memo'].forEach(id=>document.getElementById(id).value='');
pdf='';const d=document.getElementById('dz');d.classList.remove('done');d.querySelector('.dz-i').textContent='ğŸ“';
d.querySelector('.dz-m').textContent='PDF íŒŒì¼ ì„ íƒ';d.querySelector('.dz-s').textContent='1, 2í•™ë…„ ìƒê¸°ë¶€ í¬í•¨';
document.getElementById('fI').classList.add('hidden');document.getElementById('fi').value='';
// ë²ˆí˜¸ ìë™ +1
const curNo=parseInt(document.getElementById('sNo').value)||0;
if(curNo<30)document.getElementById('sNo').value=String(curNo+1).padStart(2,'0');
updPreview();chk();window.scrollTo({top:0,behavior:'smooth'})}
</script>
</body>
</html>
