<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ê¸°</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#F4F5F7;--white:#FFF;--black:#191F28;--g1:#333D4B;--g2:#4E5968;--g3:#8B95A1;--g4:#B0B8C1;--g5:#D1D6DB;--g6:#E5E8EB;--g7:#F2F4F6;
--blue:#3182F6;--blue-bg:#EBF4FF;--coral:#FF6B6B;--coral-bg:#FFF0F0;--green:#00C471;--green-bg:#E8FAF0;--purple:#7B61FF;--purple-bg:#F0EDFF;--orange:#FF9F43;--orange-bg:#FFF5EB;--teal:#22B8CF;--teal-bg:#E3FAFC;
--sh:0 2px 8px rgba(0,0,0,0.04);--sh2:0 4px 16px rgba(0,0,0,0.06);
--r:20px;--rm:16px;--rs:12px;--rx:10px;
}
body{font-family:'Noto Sans KR',-apple-system,sans-serif;background:var(--bg);color:var(--black);line-height:1.6;-webkit-font-smoothing:antialiased}
.wrap{max-width:1080px;margin:0 auto;padding:0 24px 60px}

/* Class Banner - ìµœìƒë‹¨ */
.class-banner{
background:linear-gradient(135deg,#0F3A8C 0%,#1B5BD6 40%,#3182F6 70%,#22B8CF 100%);
border-radius:var(â€“r);padding:20px 24px;margin:0 0 12px;
display:flex;align-items:center;gap:20px;
color:#fff;position:relative;overflow:hidden;
box-shadow:0 4px 20px rgba(49,130,246,0.3);
}
.class-banner::before{content:â€™â€™;position:absolute;top:-50px;right:-30px;width:180px;height:180px;background:rgba(255,255,255,0.05);border-radius:50%}
.cb-main{flex:1;min-width:0;z-index:1}
.cb-class{font-size:30px;font-weight:900;letter-spacing:-1px;line-height:1.1}
.cb-meta{font-size:13px;font-weight:500;margin-top:4px;opacity:0.85;display:flex;align-items:center;gap:0}
.cb-school{font-weight:600}
.cb-divider{margin:0 8px;opacity:0.5}
.cb-teacher{font-weight:800}
.cb-stats{display:flex;align-items:center;gap:4px;flex-shrink:0;z-index:1}
.cb-stat{text-align:center;padding:8px 12px}
.cb-stat-num{font-size:26px;font-weight:900;line-height:1}
.cb-stat-label{font-size:10px;font-weight:600;opacity:0.65;margin-top:2px}
.cb-stat-sep{font-size:20px;opacity:0.3;font-weight:300}
.cb-edit{position:absolute;top:10px;right:12px;background:rgba(255,255,255,0.15);border:none;color:#fff;width:32px;height:32px;border-radius:8px;font-size:14px;cursor:pointer;z-index:2;display:flex;align-items:center;justify-content:center;transition:background .2s}
.cb-edit:hover{background:rgba(255,255,255,0.3)}
@media(max-width:600px){
.class-banner{flex-wrap:wrap;padding:16px 18px;gap:8px}
.cb-class{font-size:24px}
.cb-meta{font-size:12px}
}
.class-banner-empty{
background:var(â€“g7);border:2px dashed var(â€“g5);border-radius:var(â€“r);
padding:20px 24px;margin:0 0 12px;display:flex;align-items:center;gap:14px;
color:var(â€“g2);font-size:14px;
}

/* Title Row */
.title-row{
display:flex;align-items:center;justify-content:space-between;
padding:16px 0 10px;
}
.title-left{display:flex;align-items:baseline;gap:8px}
.title-left h1{font-size:24px;font-weight:900;letter-spacing:-1px;color:var(â€“black)}
.title-sub{font-size:12px;color:var(â€“g3);font-weight:500;letter-spacing:-.2px}
.title-ver{background:var(â€“blue-bg);color:var(â€“blue);padding:2px 8px;border-radius:100px;font-size:10px;font-weight:700}

/* Feature Icons */
.feat-icons{display:flex;gap:6px}
.fi{display:flex;flex-direction:column;align-items:center;gap:2px;
padding:6px 10px;border-radius:10px;background:var(â€“g7);
font-size:18px;cursor:default;transition:transform .15s}
.fi:hover{transform:translateY(-2px)}
.fi span{font-size:9px;font-weight:600;color:var(â€“g3)}
@media(max-width:600px){
.title-row{flex-direction:column;align-items:flex-start;gap:8px}
.feat-icons{gap:4px}
.fi{padding:5px 8px;font-size:16px}
}

/* Compact Row - API + PDF */
.compact-row{display:grid;grid-template-columns:1fr 1.3fr;gap:10px;margin-bottom:10px}
@media(max-width:600px){.compact-row{grid-template-columns:1fr}}
.compact-card{background:var(â€“white);border-radius:var(â€“rm);padding:14px 16px;box-shadow:var(â€“sh)}
.cc-hdr{font-size:13px;font-weight:700;color:var(â€“g1);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.cc-icon{font-size:16px}
.cc-body{font-size:12px}
.dz-mini{padding:12px 16px;border-radius:10px;display:flex;align-items:center;gap:10px;cursor:pointer;
border:2px dashed var(â€“g5);background:var(â€“g7);transition:border-color .2s}
.dz-mini:hover{border-color:var(â€“blue)}
.dz-mini .dz-i{font-size:24px;flex-shrink:0}
.dz-mini .dz-m{font-size:12px;font-weight:600;color:var(â€“g2)}
.dz-mini.done{border-color:var(â€“green);background:var(â€“green-bg)}
.dz-mini.done .dz-m{color:var(â€“green)}

/* 2-col layout for wide screens */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:760px){.grid2{grid-template-columns:1fr}}

/* Card */
.card{background:var(â€“white);border-radius:var(â€“r);padding:24px;margin-top:14px;box-shadow:var(â€“sh);transition:box-shadow .3s}
.card:hover{box-shadow:var(â€“sh2)}
.card-top{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.c-icon{width:44px;height:44px;border-radius:var(â€“rs);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.c-icon.blue{background:var(â€“blue-bg)}.c-icon.coral{background:var(â€“coral-bg)}.c-icon.green{background:var(â€“green-bg)}.c-icon.purple{background:var(â€“purple-bg)}.c-icon.orange{background:var(â€“orange-bg)}.c-icon.teal{background:var(â€“teal-bg)}
.c-title{font-size:17px;font-weight:800;letter-spacing:-.3px}
.c-desc{font-size:13px;color:var(â€“g3)}

/* Form */
label{font-size:13px;font-weight:600;color:var(â€“g2);display:block;margin-bottom:5px}
input[type=text],input[type=password],textarea,select{width:100%;padding:12px 14px;background:var(â€“g7);border:1.5px solid transparent;border-radius:var(â€“rx);font-size:15px;color:var(â€“black);font-family:inherit;transition:all .2s;-webkit-appearance:none}
input::placeholder,textarea::placeholder{color:var(â€“g4);font-weight:400}
input:focus,textarea:focus,select:focus{outline:none;border-color:var(â€“blue);background:var(â€“white);box-shadow:0 0 0 3px rgba(49,130,246,.1)}
textarea{resize:vertical;min-height:72px}
select{cursor:pointer;background-image:url(â€œdata:image/svg+xml,%3Csvg xmlns=â€˜http://www.w3.org/2000/svgâ€™ width=â€˜12â€™ height=â€˜12â€™ fill=â€™%238B95A1â€™ viewBox=â€˜0 0 16 16â€™%3E%3Cpath d=â€˜M8 11L3 6h10zâ€™/%3E%3C/svg%3Eâ€);background-repeat:no-repeat;background-position:right 14px center;padding-right:34px}
.row{display:grid;gap:10px}.r2{grid-template-columns:1fr 1fr}.r3{grid-template-columns:1fr 1fr 1fr}.r4{grid-template-columns:1fr 1fr 1fr 1fr}.r5{grid-template-columns:1fr 1fr 1fr 1fr 1fr}
@media(max-width:600px){.r4,.r5{grid-template-columns:1fr 1fr}}
.stu-id{font-size:14px;font-weight:800;color:var(â€“blue);background:var(â€“blue-bg);padding:10px 16px;border-radius:var(â€“rx);text-align:center;margin-top:8px;letter-spacing:1px}

/* Btn */
.btn{padding:14px 24px;border:none;border-radius:var(â€“rs);font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;transition:all .2s;display:inline-flex;align-items:center;justify-content:center;gap:8px}
.btn:active{transform:scale(.97)}
.btn-blue{background:var(â€“blue);color:#fff}.btn-blue:hover{background:#2272E6}
.btn-blue:disabled{background:var(â€“g6);color:var(â€“g4);cursor:not-allowed;transform:none}
.btn-green{background:var(â€“green);color:#fff}.btn-green:hover{background:#00B065}
.btn-purple{background:var(â€“purple);color:#fff}.btn-purple:hover{background:#6B50EE}
.btn-ghost{background:var(â€“g7);color:var(â€“g1);font-weight:600}.btn-ghost:hover{background:var(â€“g6)}
.btn-sm{padding:10px 16px;font-size:13px;border-radius:var(â€“rx)}
.btn-full{width:100%}

/* API */
.api-row{display:flex;gap:8px;align-items:end}.api-row .f{flex:1}
.api-st{font-size:12px;font-weight:600;margin-top:6px}.api-ok{color:var(â€“green)}.api-no{color:var(â€“coral)}

/* Dropzone */
.dz{border:2px dashed var(â€“g5);border-radius:var(â€“r);padding:40px 20px;text-align:center;cursor:pointer;transition:all .3s;background:var(â€“g7)}
.dz:hover,.dz.drag{border-color:var(â€“blue);background:var(â€“blue-bg)}
.dz.done{border-color:var(â€“green);background:var(â€“green-bg);border-style:solid}
.dz-i{font-size:40px;margin-bottom:10px}
.dz-m{font-size:15px;font-weight:700}
.dz-s{font-size:13px;color:var(â€“g3);margin-top:4px}
.file-input{display:none}
.f-info{margin-top:10px;padding:12px 14px;background:var(â€“green-bg);border-radius:var(â€“rx);font-size:13px;color:var(â€“green);font-weight:600}

/* Preset */
.presets{display:flex;gap:8px}
.pre{flex:1;padding:14px;border:2px solid var(â€“g6);border-radius:var(â€“rs);background:var(â€“white);cursor:pointer;text-align:center;transition:all .2s}
.pre:hover{border-color:var(â€“g5);background:var(â€“g7)}
.pre.on{border-color:var(â€“ac,var(â€“blue));background:var(â€“abg,var(â€“blue-bg))}
.pre .em{font-size:24px;display:block;margin-bottom:6px}
.pre .tx{font-size:13px;font-weight:700;color:var(â€“g2)}.pre.on .tx{color:var(â€“ac,var(â€“blue))}
.ptags{display:flex;gap:6px;align-items:center;margin-top:12px;flex-wrap:wrap}
.ptag{padding:6px 14px;border-radius:100px;font-size:12px;font-weight:700}
.pt1{background:var(â€“blue-bg);color:var(â€“blue)}.pt2{background:var(â€“purple-bg);color:var(â€“purple)}.pt3{background:var(â€“g7);color:var(â€“g3)}
.pt-a{color:var(â€“g4);font-size:12px}

/* KW */
.kws{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
.kw{padding:8px 16px;border:1.5px solid var(â€“g6);border-radius:100px;font-size:13px;font-weight:500;color:var(â€“g2);cursor:pointer;transition:all .2s;user-select:none;background:var(â€“white)}
.kw:hover{border-color:var(â€“g4)}.kw.on{border-color:var(â€“blue);background:var(â€“blue-bg);color:var(â€“blue);font-weight:600}

/* Progress */
.pw{margin:16px 0;display:none}
.ptr{width:100%;height:6px;background:var(â€“g6);border-radius:3px;overflow:hidden}
.pfl{height:100%;background:linear-gradient(90deg,var(â€“blue),var(â€“purple));border-radius:3px;transition:width .6s;width:0}
.ptx{text-align:center;font-size:14px;color:var(â€“g3);margin-top:10px;font-weight:600}

/* Tabs */
.tabs{display:flex;gap:4px;background:var(â€“g7);border-radius:var(â€“rs);padding:4px;margin-bottom:20px;overflow-x:auto}
.tab{padding:11px 16px;cursor:pointer;font-size:13px;font-weight:500;color:var(â€“g3);border-radius:var(â€“rx);white-space:nowrap;transition:all .2s;text-align:center;flex:1}
.tab:hover{color:var(â€“g2)}.tab.on{background:var(â€“white);color:var(â€“black);font-weight:700;box-shadow:var(â€“sh)}
.tc{display:none}.tc.on{display:block}

/* Report */
.rb{background:var(â€“g7);border-radius:var(â€“rs);padding:18px;margin-bottom:10px}
.rb h4{font-size:14px;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.rb p{font-size:14px;color:var(â€“g2);line-height:1.75}
.opt{border-radius:var(â€“rs);padding:18px;margin:10px 0;background:var(â€“white);box-shadow:var(â€“sh);border:1px solid var(â€“g6);transition:all .3s}
.opt:hover{box-shadow:var(â€“sh2);transform:translateY(-1px)}
.oh{font-weight:700;font-size:14px;margin-bottom:8px;display:flex;align-items:center;gap:8px}
.ob{font-size:13px;color:var(â€“g2);line-height:1.8;white-space:pre-wrap}
.of{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
.of span{font-size:12px;color:var(â€“g3);font-weight:500}
.badge{display:inline-flex;padding:4px 10px;border-radius:100px;font-size:11px;font-weight:700}
.b-bl{background:var(â€“blue-bg);color:var(â€“blue)}.b-pu{background:var(â€“purple-bg);color:var(â€“purple)}
.b-gr{background:var(â€“green-bg);color:var(â€“green)}.b-co{background:var(â€“coral-bg);color:var(â€“coral)}
.b-or{background:var(â€“orange-bg);color:var(â€“orange)}.b-gy{background:var(â€“g7);color:var(â€“g3)}
.cg{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:600px){.cg{grid-template-columns:1fr}}
.ci{padding:16px;border-radius:var(â€“rs);background:var(â€“white);box-shadow:var(â€“sh);border:1px solid var(â€“g6)}
.ci strong{font-size:13px;display:block;margin-bottom:8px}
.ci p{font-size:12px;color:var(â€“g2);line-height:1.65;margin:4px 0}
.tbl{width:100%;border-collapse:separate;border-spacing:0;font-size:13px;border-radius:var(â€“rx);overflow:hidden;border:1px solid var(â€“g6)}
.tbl th{padding:10px 14px;background:var(â€“g7);color:var(â€“g2);font-weight:700;text-align:left}
.tbl td{padding:10px 14px;border-top:1px solid var(â€“g6);color:var(â€“g2)}
.tbl tr:hover td{background:var(â€“g7)}

/* Student list */
.sl{max-height:240px;overflow-y:auto;border-radius:var(â€“rx);margin-top:10px}
.si{padding:12px 4px;display:flex;justify-content:space-between;align-items:center;font-size:14px;border-bottom:1px solid var(â€“g6)}
.si:last-child{border:none}
.si .num{font-weight:800;color:var(â€“blue);margin-right:8px;font-size:13px;background:var(â€“blue-bg);padding:3px 8px;border-radius:6px}
.si .meta{color:var(â€“g3);font-size:12px;font-weight:500}

.actions{display:flex;gap:10px;flex-wrap:wrap;margin:16px 0}
.result-section{display:none;margin-top:14px}
.res-header{background:linear-gradient(135deg,#EBF4FF,#F0EDFF);border-radius:var(â€“r);padding:24px;margin-bottom:16px}
.res-header h2{font-size:22px;font-weight:900;color:var(â€“blue);margin-bottom:8px;letter-spacing:-.5px}
.res-info{display:flex;flex-wrap:wrap;gap:14px;font-size:13px;font-weight:600;color:var(â€“g1)}
.res-info span{color:var(â€“blue)}
.res-sec{background:var(â€“white);border-radius:var(â€“r);padding:24px;margin-bottom:14px;box-shadow:var(â€“sh)}
.res-sec h3{font-size:17px;font-weight:800;color:var(â€“black);margin-bottom:14px;padding-bottom:10px;border-bottom:2px solid var(â€“g6);display:flex;align-items:center;gap:8px}
.res-summary{font-size:14px;line-height:1.85;color:var(â€“g1);padding:16px 20px;background:var(â€“g7);border-radius:12px;border-left:4px solid var(â€“blue);margin-bottom:14px}
.res-chips{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
.chip-s{padding:8px 14px;border-radius:10px;font-size:12px;font-weight:600;line-height:1.6}
.chip-s.green{background:var(â€“green-bg);color:var(â€“green)}.chip-s.coral{background:var(â€“coral-bg);color:var(â€“coral)}
.comp-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:600px){.comp-grid{grid-template-columns:1fr}}
.comp-card{border-radius:12px;padding:16px 18px;background:var(â€“g7);border-left:4px solid var(â€“blue)}
.comp-card.purple{border-left-color:var(â€“purple)}.comp-card.green-c{border-left-color:var(â€“green)}.comp-card.orange{border-left-color:var(â€“orange)}
.comp-label{font-size:14px;font-weight:800;margin-bottom:10px}
.comp-row{display:flex;gap:8px;margin:5px 0;font-size:13px;line-height:1.7;color:var(â€“g2)}
.comp-row .tag{min-width:48px;font-weight:700;color:var(â€“g3);flex-shrink:0}
.opt-area-title{font-size:15px;font-weight:800;margin:20px 0 10px;display:flex;align-items:center;gap:8px}
.opt-eval{font-size:13px;color:var(â€“g2);line-height:1.7;padding:10px 14px;background:var(â€“g7);border-radius:8px;margin-bottom:10px}
.opt-pair{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:700px){.opt-pair{grid-template-columns:1fr}}
.opt-box{border:1.5px solid var(â€“g6);border-radius:12px;padding:16px;background:#fff}
.opt-head{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:8px;font-size:13px;font-weight:700}
.opt-badge{padding:3px 10px;border-radius:100px;font-size:11px;font-weight:700;color:#fff}
.opt-badge.b1{background:var(â€“blue)}.opt-badge.b2{background:var(â€“purple)}
.byte-info{font-size:11px;font-weight:600;color:var(â€“g3);margin-left:auto}
.byte-info.over{color:var(â€“coral)}
.opt-text{font-size:13px;color:var(â€“g1);line-height:1.85;white-space:pre-wrap;padding:12px 14px;background:var(â€“g7);border-radius:8px}
.opt-tip{font-size:11px;color:var(â€“g3);margin-top:8px;font-weight:500}
.setuk-card{padding:14px 16px;background:var(â€“g7);border-radius:10px;margin:8px 0;border:1px solid var(â€“g6)}
.setuk-name{font-size:14px;font-weight:800;color:var(â€“blue)}
.setuk-theme{font-size:13px;font-weight:600;color:var(â€“g1);margin:6px 0}
.setuk-reason{font-size:12px;color:var(â€“g2);line-height:1.7}
.setuk-kws{margin-top:8px}
.kw-tag{display:inline-block;padding:3px 10px;background:var(â€“blue-bg);color:var(â€“blue);border-radius:100px;font-size:11px;font-weight:600;margin:2px}
.club-tbl{width:100%;border-collapse:separate;border-spacing:0;border-radius:10px;overflow:hidden;border:1px solid var(â€“g6);font-size:12px}
.club-tbl th{padding:10px 14px;background:var(â€“g7);font-weight:700;text-align:left;color:var(â€“g2)}
.club-tbl td{padding:10px 14px;border-top:1px solid var(â€“g6);color:var(â€“g1);line-height:1.65}
.co-card{margin:10px 0;padding:14px 16px;background:var(â€“g7);border-radius:10px}
.co-card h4{font-size:13px;font-weight:700;margin-bottom:8px;color:var(â€“g1)}
.co-card p{font-size:12px;color:var(â€“g2);line-height:1.7;margin:4px 0}
.byte-badge{font-size:11px;background:var(â€“g7);color:var(â€“g3);padding:2px 8px;border-radius:100px;font-weight:600}
.hidden{display:none}
@media print{body{background:#fff}.no-print{display:none!important}.card{box-shadow:none;border:1px solid #eee}}
</style>

</head>
<body>
<div class="wrap">

<!-- â‘  í•™ê¸‰ ë°°ë„ˆ (ì„¤ì • ì™„ë£Œ í›„ ìµœìƒë‹¨ì— í‘œì‹œ) -->

<div class="class-banner" id="classBanner" style="display:none">
<div class="cb-main">
<div class="cb-class" id="cbClass">3í•™ë…„ 2ë°˜</div>
<div class="cb-meta"><span class="cb-school" id="cbSchool">â—‹â—‹ê³ ë“±í•™êµ</span><span class="cb-divider">Â·</span>ë‹´ì„ <span class="cb-teacher" id="cbTeacher">í™ê¸¸ë™</span> ì„ ìƒë‹˜</div>
</div>
<div class="cb-stats">
<div class="cb-stat"><div class="cb-stat-num" id="cbCount">0</div><div class="cb-stat-label">ì™„ë£Œ</div></div>
<div class="cb-stat-sep">/</div>
<div class="cb-stat"><div class="cb-stat-num" id="cbTotal">30</div><div class="cb-stat-label">ì „ì²´</div></div>
</div>
<button class="cb-edit" onclick="toggleClassSetup()">âš™ï¸</button>
</div>

<!-- â‘¡ íƒ€ì´í‹€ + ê¸°ëŠ¥ ì•„ì´ì½˜ -->

<div class="title-row">
<div class="title-left">
<h1>ì„¸ê³µì‚¬</h1>
<span class="title-sub">ì„¸íŠ¹Â·ìƒê¸°ë¶€Â·ê³µë™ì²´Â·ì‚¬ëŒ</span>
<span class="title-ver">v1.0</span>
</div>
<div class="feat-icons no-print">
<div class="fi" title="PDF ì—…ë¡œë“œ">ğŸ“„<span>ì—…ë¡œë“œ</span></div>
<div class="fi" title="AI ë¶„ì„">ğŸ¤–<span>AIë¶„ì„</span></div>
<div class="fi" title="PDF ë³´ê³ ì„œ">ğŸ“Š<span>ë³´ê³ ì„œ</span></div>
<div class="fi" title="ì—‘ì…€ ì €ì¥">ğŸ“‹<span>ì—‘ì…€</span></div>
<div class="fi" title="ì„¸íŠ¹ ì˜ˆì‹œ">ğŸ¯<span>ì„¸íŠ¹</span></div>
<div class="fi" title="ìƒë‹´ ê°€ì´ë“œ">ğŸ’¬<span>ìƒë‹´</span></div>
</div>
</div>

<!-- â‘¢ ì´ˆê¸° ì„¤ì • ì˜ì—­ (API â†’ í•™ê¸‰ ìˆœì„œ) -->

<div id="setupArea" class="no-print">

<!-- API ì—°ê²° (ë¨¼ì €) -->

<div class="compact-card" id="apiCard" style="margin-bottom:10px">
<div class="cc-hdr"><span class="cc-icon">ğŸ”‘</span> API ì—°ê²°</div>
<div class="cc-body">
<div class="api-row"><div class="f"><input type="password" id="apiKey" placeholder="sk-ant-..." style="font-size:12px;padding:8px 10px"/></div><button class="btn btn-blue btn-sm" onclick="saveKey()" style="padding:8px 12px;font-size:11px">ì €ì¥</button></div>
<div style="margin-top:6px"><select id="modelSel" style="font-size:11px;padding:6px 8px;width:100%">
<option value="claude-sonnet-4-5-20250929" selected>Sonnet 4.5</option>
<option value="claude-sonnet-4-20250514">Sonnet 4</option>
<option value="claude-haiku-4-5-20251001">Haiku 4.5 (ë¹ ë¦„)</option>
</select></div>
<div class="api-st" id="apiSt"></div>
</div>
</div>

<!-- í•™ê¸‰ ì„¤ì • (API ë‹¤ìŒ) -->

<div class="card" id="classSetupCard" style="border:2px solid var(--blue);background:linear-gradient(135deg,#FAFBFF,#F0F4FF)">
<div class="card-top"><div class="c-icon blue">ğŸ«</div><div><div class="c-title">í•™ê¸‰ ì„¤ì •</div><div class="c-desc">í•œ ë²ˆ ì„¤ì •í•˜ë©´ í•™ìƒ ë°ì´í„°ê°€ ì´ í•™ê¸‰ì— ëˆ„ì ë©ë‹ˆë‹¤</div></div></div>
<div class="row r4">
<div><label>í•™ë…„</label><select id="sGrade"><option value="3">3í•™ë…„</option><option value="2">2í•™ë…„</option><option value="1">1í•™ë…„</option></select></div>
<div><label>ë°˜</label><select id="sClass"><option value="">ì„ íƒ</option></select></div>
<div><label>ë‹´ì„êµì‚¬</label><input type="text" id="sTeacher" placeholder="í™ê¸¸ë™"/></div>
<div><label>í•™êµëª…</label><input type="text" id="sSchool" placeholder="â—‹â—‹ê³ ë“±í•™êµ"/></div>
</div>
<div style="display:flex;gap:8px;margin-top:10px">
<button class="btn btn-blue btn-sm" onclick="saveClassInfo()">ğŸ’¾ í•™ê¸‰ ì €ì¥</button>
<button class="btn btn-ghost btn-sm" onclick="resetClass()" style="font-size:12px">ğŸ—‘ï¸ í•™ê¸‰ ì´ˆê¸°í™”</button>
<button class="btn btn-ghost btn-sm" onclick="resetAll()" style="font-size:12px;color:var(--coral)">âš ï¸ ì „ì²´ ë¦¬ì…‹</button>
</div>
<div id="classStatus" style="margin-top:8px;font-size:12px;font-weight:600"></div>
</div>

</div>

<!-- â‘£ ì‘ì—… ì˜ì—­ (í•™ê¸‰ ì„¤ì • ì™„ë£Œ í›„ í‘œì‹œ) -->

<div id="workArea" style="display:none">

<!-- API + PDF ì—…ë¡œë“œ (í•œì¤„) -->

<div class="compact-row no-print">
<div class="compact-card">
<div class="cc-hdr"><span class="cc-icon">ğŸ”‘</span> API <span id="apiMiniStatus" style="font-size:11px;color:var(--green);margin-left:6px">âœ“</span></div>
<div class="cc-body">
<div class="api-row"><div class="f"><input type="password" id="apiKey2" placeholder="sk-ant-..." style="font-size:12px;padding:8px 10px"/></div><button class="btn btn-blue btn-sm" onclick="saveKey2()" style="padding:8px 12px;font-size:11px">ì €ì¥</button></div>
<div style="margin-top:6px"><select id="modelSel2" style="font-size:11px;padding:6px 8px;width:100%">
<option value="claude-sonnet-4-5-20250929" selected>Sonnet 4.5</option>
<option value="claude-sonnet-4-20250514">Sonnet 4</option>
<option value="claude-haiku-4-5-20251001">Haiku 4.5 (ë¹ ë¦„)</option>
</select></div>
</div>
</div>
<div class="compact-card" style="flex:1.2">
<div class="cc-hdr"><span class="cc-icon">ğŸ“</span> ìƒê¸°ë¶€ ì—…ë¡œë“œ</div>
<div class="cc-body">
<div class="dz dz-mini" id="dz" onclick="document.getElementById('fi').click()">
<div class="dz-i">ğŸ“„</div><div class="dz-m">PDF íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸</div><div class="dz-s" style="display:none"></div>
</div>
<input type="file" id="fi" class="file-input" accept=".pdf"/>
<div id="fI" class="hidden f-info"></div>
</div>
</div>
</div>

<!-- í•™ìƒ ì •ë³´ -->

<div class="card no-print">
<div class="card-top"><div class="c-icon green">ğŸ‘¤</div><div><div class="c-title">í•™ìƒ ì •ë³´</div><div class="c-desc">PDF ì—…ë¡œë“œ ì‹œ ìë™ ì¶”ì¶œ Â· ìˆ˜ì • ê°€ëŠ¥</div></div></div>
<div class="row r4">
<div><label>ë²ˆí˜¸</label><select id="sNo"><option value="">ì„ íƒ</option></select></div>
<div><label>ì´ë¦„</label><input type="text" id="sName" placeholder="í™ê¸¸ë™"/></div>
<div><label>í¬ë§ ì§„ë¡œ</label><input type="text" id="sCareer" placeholder="ê°„í˜¸ì‚¬"/></div>
<div><label>ë™ì•„ë¦¬ëª…</label><input type="text" id="sClub" placeholder="ê³¼í•™íƒêµ¬ë°˜"/></div>
</div>
<div style="margin-top:8px"><label>í•™ë²ˆ ë¯¸ë¦¬ë³´ê¸°</label><div class="stu-id" id="stuIdPreview">3 - -- - --</div></div>
</div>
</div>

<!-- Priority + KW side by side on wide -->

<div class="grid2">

<div class="card no-print">
<div class="card-top"><div class="c-icon purple">ğŸ¯</div><div><div class="c-title">ìš°ì„ ìˆœìœ„ ì„¤ì •</div><div class="c-desc">ë³´ê³ ì„œ ì‘ì„± ë°©í–¥</div></div></div>
<div class="presets">
<div class="pre" onclick="setP('top')" id="pTop" style="--ac:#3182F6;--abg:#EBF4FF"><span class="em">ğŸ†</span><span class="tx">1~2ë“±ê¸‰</span></div>
<div class="pre" onclick="setP('mid')" id="pMid" style="--ac:#7B61FF;--abg:#F0EDFF"><span class="em">ğŸ¯</span><span class="tx">3~5ë“±ê¸‰</span></div>
<div class="pre" onclick="setP('cus')" id="pCus" style="--ac:#4E5968;--abg:#F2F4F6"><span class="em">âš™ï¸</span><span class="tx">ì§ì ‘ì„¤ì •</span></div>
</div>
<div id="cusP" class="hidden" style="margin-top:10px">
<div class="row r3">
<div><label>1ìˆœìœ„</label><select id="p1" onchange="upP()"><option>í•™ì—…</option><option>ì§„ë¡œ</option><option>ê³µë™ì²´</option></select></div>
<div><label>2ìˆœìœ„</label><select id="p2" onchange="upP()"><option>ì§„ë¡œ</option><option>í•™ì—…</option><option>ê³µë™ì²´</option></select></div>
<div><label>3ìˆœìœ„</label><select id="p3" disabled><option>ê³µë™ì²´</option></select></div>
</div>
</div>
<div class="ptags" id="ptags">
<span class="ptag pt1" id="t1">1ìˆœìœ„ í•™ì—…</span><span class="pt-a">â†’</span>
<span class="ptag pt2" id="t2">2ìˆœìœ„ ì§„ë¡œ</span><span class="pt-a">â†’</span>
<span class="ptag pt3" id="t3">3ìˆœìœ„ ê³µë™ì²´</span>
</div>
</div>

<div class="card no-print">
<div class="card-top"><div class="c-icon orange">ğŸ·ï¸</div><div><div class="c-title">í‚¤ì›Œë“œ ì„ íƒ</div><div class="c-desc">ë³´ê³ ì„œì— ë°˜ì˜í•  í‚¤ì›Œë“œ</div></div></div>
<div class="kws" id="kwG"></div>
<label style="margin-top:6px">ì§ì ‘ ì…ë ¥</label>
<input type="text" id="kwC" placeholder="ESGê²½ì˜, ë¹…ë°ì´í„° (ì‰¼í‘œ êµ¬ë¶„)"/>
</div>

</div>

<!-- Memo -->

<div class="card no-print">
<div class="card-top"><div class="c-icon teal">ğŸ’¡</div><div><div class="c-title">ìƒë‹´ ë©”ëª¨</div><div class="c-desc">ì„ íƒ Â· ì¶”ê°€ ì •ë³´</div></div></div>
<textarea id="memo" placeholder="í•™ìƒ íŠ¹ì´ì‚¬í•­, ê°•ì¡° í¬ì¸íŠ¸, ë³´ì™„í•  ì  ë“±"></textarea>
</div>

<!-- Go -->

<button class="btn btn-blue btn-full no-print" id="goBtn" onclick="analyze()" disabled style="margin-top:14px;padding:16px;font-size:16px;border-radius:var(--r)">ğŸ” AI ì¢…í•© ë¶„ì„ ì‹œì‘</button>

<div class="pw no-print" id="pW"><div class="ptr"><div class="pfl" id="pF"></div></div><div class="ptx" id="pT"></div></div>
<div id="errMsg" style="display:none;margin:10px 0;padding:14px 18px;background:#FFF0F0;border:1.5px solid #FF6B6B;border-radius:12px;color:#FF6B6B;font-size:14px;font-weight:600" class="no-print"></div>

<!-- Results -->

<div class="result-section" id="resS">
<div id="resContent"></div>
<div class="actions no-print" style="margin-top:16px">
<button class="btn btn-green" onclick="dlPDF()" style="flex:1">ğŸ“„ ì´ í•™ìƒ PDF</button>
<button class="btn btn-purple" onclick="dlXL()" style="flex:1">ğŸ“Š ì—‘ì…€ ì €ì¥</button>
<button class="btn btn-ghost" onclick="next()" style="flex:1">â¡ï¸ ë‹¤ìŒ í•™ìƒ</button>
</div>
</div>

<!-- Student Summary -->

<div class="card no-print">
<div class="card-top"><div class="c-icon green">ğŸ“‹</div><div><div class="c-title">ë¶„ì„ ì™„ë£Œ í•™ìƒ</div><div class="c-desc" id="stuCnt">0ëª… ì™„ë£Œ</div></div></div>
<div class="sl" id="stuL"><div style="padding:20px;color:var(--g4);text-align:center;font-size:14px">ì•„ì§ ë¶„ì„ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</div></div>
<div class="actions" style="margin-top:12px">
<button class="btn btn-purple btn-sm" onclick="dlAll()" style="flex:1">ğŸ“Š ì „ì²´ ì—‘ì…€</button>
<button class="btn btn-green btn-sm" onclick="dlAllPDF()" style="flex:1">ğŸ“„ ì „ì²´ PDF ë¬¶ìŒ</button>
</div>
<div style="font-size:11px;color:var(--g3);margin-top:8px;text-align:center">ğŸ’¡ í•™ìƒ ì´ë¦„ì„ í´ë¦­í•˜ë©´ ë³´ê³ ì„œë¥¼ ë‹¤ì‹œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
</div>

</div>

<script>
let pdf='',key='',pri=['í•™ì—…','ì§„ë¡œ','ê³µë™ì²´'],selKW=[],stu={},cur=null,classInfo={};
const KW=['ìê¸°ì£¼ë„í•™ìŠµ','ë¹„íŒì ì‚¬ê³ ','ë°ì´í„°ë¶„ì„','ë¦¬ë”ì‹­','í˜‘ì—…','ë¬¸ì œí•´ê²°','ë°œí‘œë ¥','ë´‰ì‚¬í™œë™','ìœµí•©ì‚¬ê³ ','ì°½ì˜ì„±','ì˜ì‚¬ì†Œí†µ','ê¸€ë¡œë²Œì—­ëŸ‰','ë””ì§€í„¸ë¦¬í„°ëŸ¬ì‹œ','ì—°êµ¬ì—­ëŸ‰','ì§„ë¡œíƒìƒ‰','ë©˜í† ë§','í”„ë¡œì íŠ¸ê¸°íš','ë…ì„œí™œë™'];

(function(){
// pdf.js worker ì„¤ì • - ë¡œì»¬ file:// ì—ì„œë„ ë™ì‘í•˜ë„ë¡
if(window.location.protocol==='file:'){
// ë¡œì»¬ íŒŒì¼ì—ì„œëŠ” worker ë¹„í™œì„±í™” (ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰)
pdfjsLib.GlobalWorkerOptions.workerSrc='';
pdfjsLib.disableWorker=true;
console.log('[PDF.js] ë¡œì»¬ ëª¨ë“œ - worker ë¹„í™œì„±í™”');
}else{
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
}
// ë°˜ 01~10
const sc=document.getElementById('sClass');for(let i=1;i<=10;i++){const o=document.createElement('option');o.value=String(i).padStart(2,'0');o.textContent=i+'ë°˜';sc.appendChild(o)}
// ë²ˆí˜¸ 01~30
const sn=document.getElementById('sNo');for(let i=1;i<=30;i++){const o=document.createElement('option');o.value=String(i).padStart(2,'0');o.textContent=i+'ë²ˆ';sn.appendChild(o)}
// í•™ë²ˆ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
['sNo','sName','sCareer','sClub'].forEach(id=>{const el=document.getElementById(id);if(el)el.addEventListener('change',()=>{updPreview();chk()})});

const g=document.getElementById('kwG');KW.forEach(k=>{const d=document.createElement('div');d.className='kw';d.textContent=k;d.onclick=()=>{d.classList.toggle('on');d.classList.contains('on')?selKW.push(k):selKW=selKW.filter(x=>x!==k)};g.appendChild(d)});
const sv=localStorage.getItem('sgb_key');if(sv){key=sv;document.getElementById('apiKey').value=sv;apiOk()}

// í•™ê¸‰ ì •ë³´ ë¡œë“œ
loadClassInfo();

chk();setP('top');
})();

function getStuId(){
const g=classInfo.grade||'3';
const c=classInfo.cls||'';
const n=document.getElementById('sNo').value;
if(!c||!n)return'';
// 3í•™ë…„ 2ë°˜ 2ë²ˆ â†’ 3202, 3í•™ë…„ 10ë°˜ 21ë²ˆ â†’ 31021
return g+parseInt(c)+String(parseInt(n)).padStart(2,'0');
}
function updPreview(){
const id=getStuId();
const g=classInfo.grade||'3';
const c=classInfo.cls||'';
const n=document.getElementById('sNo').value;
if(id){
document.getElementById('stuIdPreview').textContent=`${id}  (${g}í•™ë…„ ${parseInt(c)}ë°˜ ${parseInt(n)}ë²ˆ)`;
}else{
document.getElementById('stuIdPreview').textContent=`${g}í•™ë…„ ${c?parseInt(c)+'ë°˜':'--ë°˜'} ${n?parseInt(n)+'ë²ˆ':'--ë²ˆ'}`;
}
}

// === í•™ê¸‰ ê´€ë¦¬ ===
function getClassKey(){
const g=document.getElementById('sGrade').value;
const c=document.getElementById('sClass').value;
return `sgb_class_${g}_${c}`;
}

function saveClassInfo(){
const g=document.getElementById('sGrade').value;
const c=document.getElementById('sClass').value;
const t=document.getElementById('sTeacher').value.trim();
const s=document.getElementById('sSchool').value.trim();
if(!c){alert('ë°˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');return}
classInfo={grade:g,cls:c,teacher:t,school:s};
localStorage.setItem('sgb_classInfo',JSON.stringify(classInfo));
loadClassStudents();
updateBanner();
switchToWorkMode();
}

function switchToWorkMode(){
// ì´ˆê¸° ì„¤ì • ì˜ì—­ ìˆ¨ê¸°ê³  ì‘ì—… ì˜ì—­ í‘œì‹œ
document.getElementById('setupArea').style.display='none';
document.getElementById('workArea').style.display='';
// API í‚¤/ëª¨ë¸ ë™ê¸°í™” (setupArea â†’ workArea)
const k=document.getElementById('apiKey').value;
const m=document.getElementById('modelSel').value;
document.getElementById('apiKey2').value=k;
document.getElementById('modelSel2').value=m;
if(key)document.getElementById('apiMiniStatus').textContent='âœ“ ì—°ê²°ë¨';
}

function switchToSetupMode(){
document.getElementById('setupArea').style.display='';
document.getElementById('workArea').style.display='none';
document.getElementById('classBanner').style.display='none';
}

function saveKey2(){
key=document.getElementById('apiKey2').value.trim();
if(!key||!key.startsWith('sk-ant-'))return;
localStorage.setItem('sgb_key',key);
document.getElementById('apiKey').value=key;
document.getElementById('apiMiniStatus').textContent='âœ“ ì—°ê²°ë¨';
chk();
}

function getModel(){
// ì‘ì—… ëª¨ë“œë©´ modelSel2, ì•„ë‹ˆë©´ modelSel
const wa=document.getElementById('workArea');
if(wa&&wa.style.display!=='none'){
return document.getElementById('modelSel2')?.value||'claude-sonnet-4-5-20250929';
}
return document.getElementById('modelSel')?.value||'claude-sonnet-4-5-20250929';
}

function updateBanner(){
const banner=document.getElementById('classBanner');
if(!classInfo.cls){
banner.style.display='none';
return;
}
banner.style.display='flex';
document.getElementById('cbSchool').textContent=classInfo.school||'í•™êµëª… ë¯¸ì„¤ì •';
document.getElementById('cbClass').textContent=`${classInfo.grade}í•™ë…„ ${parseInt(classInfo.cls)}ë°˜`;
document.getElementById('cbTeacher').textContent=classInfo.teacher||'ë¯¸ì„¤ì •';
const cnt=Object.keys(stu).filter(k=>stu[k].result&&!stu[k].result._err).length;
document.getElementById('cbCount').textContent=cnt;
}

function toggleClassSetup(){
// ë°°ë„ˆì˜ âš™ï¸ í´ë¦­ ì‹œ: ì„¤ì • ëª¨ë“œë¡œ ì „í™˜
switchToSetupMode();
// í˜„ì¬ ê°’ ì±„ìš°ê¸°
document.getElementById('sGrade').value=classInfo.grade||'3';
document.getElementById('sClass').value=classInfo.cls||'';
document.getElementById('sTeacher').value=classInfo.teacher||'';
document.getElementById('sSchool').value=classInfo.school||'';
}

function loadClassInfo(){
try{
const ci=localStorage.getItem('sgb_classInfo');
if(ci){
classInfo=JSON.parse(ci);
document.getElementById('sGrade').value=classInfo.grade||'3';
document.getElementById('sClass').value=classInfo.cls||'';
document.getElementById('sTeacher').value=classInfo.teacher||'';
document.getElementById('sSchool').value=classInfo.school||'';
loadClassStudents();
updateBanner();
if(classInfo.cls)switchToWorkMode();
}
}catch(e){console.warn('í•™ê¸‰ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨')}
}

function loadClassStudents(){
const k=getClassKey();
try{
const ss=localStorage.getItem(k);
if(ss){stu=JSON.parse(ss);rStu()}else{stu={};rStu()}
}catch(e){stu={};rStu()}
}

function saveClassStudents(){
const k=getClassKey();
try{localStorage.setItem(k,JSON.stringify(stu))}catch(e){console.warn('í•™ìƒ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨')}
}

function resetClass(){
if(!confirm('ì´ í•™ê¸‰ì˜ í•™ìƒ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(í•™ê¸‰ ì„¤ì •ì€ ìœ ì§€ë©ë‹ˆë‹¤)'))return;
const k=getClassKey();
localStorage.removeItem(k);
stu={};rStu();updateBanner();
document.getElementById('classStatus').innerHTML='<span style="color:var(--coral)">âœ“ í•™ê¸‰ ë°ì´í„° ì´ˆê¸°í™”ë¨</span>';
}

function resetAll(){
if(!confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n- API í‚¤\n- í•™ê¸‰ ì„¤ì •\n- ëª¨ë“  í•™ìƒ ë¶„ì„ ê²°ê³¼\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'))return;
// sgb_ ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  localStorage ì‚­ì œ
const keys=[];
for(let i=0;i<localStorage.length;i++){
const k=localStorage.key(i);
if(k&&k.startsWith('sgb_'))keys.push(k);
}
keys.forEach(k=>localStorage.removeItem(k));
// ìƒíƒœ ì´ˆê¸°í™”
key='';classInfo={};stu={};cur=null;pdf='';
location.reload();
}

// === í•™ìƒ í´ë¦­ â†’ ë³´ê³ ì„œ ì¬ì—´ëŒ ===
function viewStudent(sid){
const s=stu[sid];
if(!s||!s.result)return;
cur=s.result;
// í•™ìƒ ì •ë³´ ì±„ìš°ê¸°
document.getElementById('sNo').value=sid.substring(3,5);
document.getElementById('sName').value=s.name||'';
document.getElementById('sCareer').value=s.career||'';
document.getElementById('sClub').value=s.club||'';
updPreview();
// ê²°ê³¼ í‘œì‹œ
rR(cur);
// ìŠ¤í¬ë¡¤
document.getElementById('resS').scrollIntoView({behavior:'smooth'});
}

// === ê°œë³„ í•™ìƒ PDF (í•™ìƒ ëª©ë¡ì—ì„œ) ===
function dlStudentPDF(sid){
const s=stu[sid];
if(!s||!s.result||s.result._err)return;
const prevCur=cur;
cur=s.result;
dlPDF();
cur=prevCur;
}

// === ì „ì²´ í•™ìƒ PDF ë¬¶ìŒ ===
function dlAllPDF(){
const students=Object.values(stu).filter(s=>s.result&&!s.result._err).sort((a,b)=>a.sid.localeCompare(b.sid));
if(!students.length){alert('ë¶„ì„ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤');return}
const prevCur=cur;
const w=window.open('','_blank');
let allHtml='';
students.forEach((s,i)=>{
cur=s.result;
const m=cur._m;
allHtml+=buildPDFContent(cur);
if(i<students.length-1)allHtml+='<div style="page-break-after:always"></div>';
});
cur=prevCur;
const ci=classInfo;
w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${ci.school||''} ${ci.grade||'3'}í•™ë…„ ${parseInt(ci.cls)||''}ë°˜ ìƒê¸°ë¶€ ì „ì²´ ë³´ê³ ì„œ</title>
${getPDFStyles()}
</head><body>
<div class="cover"><h1>ğŸ“Š ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ ë³´ê³ ì„œ</h1>
<div class="sub">${ci.school||''} ${ci.grade||'3'}í•™ë…„ ${parseInt(ci.cls)||''}ë°˜ Â· ë‹´ì„: ${ci.teacher||''} Â· ${students.length}ëª…</div></div>
<div style="page-break-after:always"></div>
${allHtml}
</body></html>`);
w.document.close();setTimeout(()=>w.print(),1000);
}

function saveKey(){
key=document.getElementById('apiKey').value.trim();
if(!key){document.getElementById('apiSt').innerHTML='<span class="api-no">í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</span>';return}
if(!key.startsWith('sk-ant-')){document.getElementById('apiSt').innerHTML='<span class="api-no">âš ï¸ sk-ant-ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</span>';return}
localStorage.setItem('sgb_key',key);apiOk();chk();
console.log('[saveKey] í‚¤ ì €ì¥ ì™„ë£Œ, ê¸¸ì´:',key.length);
}
function apiOk(){document.getElementById('apiSt').innerHTML='<span class="api-ok">âœ“ ì €ì¥ ì™„ë£Œ</span>'}

const dz=document.getElementById('dz'),fi=document.getElementById('fi');
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('drag')});
dz.addEventListener('dragleave',()=>dz.classList.remove('drag'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('drag');e.dataTransfer.files[0]&&hf(e.dataTransfer.files[0])});
fi.addEventListener('change',e=>e.target.files[0]&&hf(e.target.files[0]));

async function hf(f){
if(f.type!=='application/pdf'){alert('PDFë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');return}
dz.classList.add('done');dz.querySelector('.dz-i').textContent='âœ…';
dz.querySelector('.dz-m').textContent=f.name;
const dzs=dz.querySelector('.dz-s');if(dzs){dzs.style.display='';dzs.textContent='ì¶”ì¶œ ì¤‘...';}
try{const b=await f.arrayBuffer();const p=await pdfjsLib.getDocument({data:b}).promise;let t='';
for(let i=1;i<=p.numPages;i++){const pg=await p.getPage(i);const tc=await pg.getTextContent();t+=tc.items.map(x=>x.str).join(' ')+'\n'}
pdf=t;
console.log('[PDF] í…ìŠ¤íŠ¸ ì¶”ì¶œ ì™„ë£Œ, ê¸¸ì´:',pdf.length);
if(pdf.length<50){if(dzs)dzs.textContent='âš ï¸ í…ìŠ¤íŠ¸ê°€ ê±°ì˜ ì—†ìŒ. ìŠ¤ìº” PDFì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤';return}
if(dzs)dzs.textContent=`${p.numPages}p Â· ${pdf.length.toLocaleString()}ì`;
autoFillStudent(t);
document.getElementById('fI').classList.remove('hidden');
document.getElementById('fI').textContent=`âœ“ ${f.name} Â· ${(f.size/1024).toFixed(0)}KB Â· ${p.numPages}í˜ì´ì§€`;chk()
}catch(e){console.error('[PDF] ì˜¤ë¥˜:',e);if(dzs)dzs.textContent='âœ• '+e.message;alert('PDF ì½ê¸° ì‹¤íŒ¨: '+e.message)}}

function setP(t){document.querySelectorAll('.pre').forEach(b=>{b.classList.remove('on');b.style.borderColor='var(--g6)';b.style.background='var(--white)';b.querySelector('.tx').style.color='var(--g2)'});document.getElementById('cusP').classList.add('hidden');
if(t==='top'){pri=['í•™ì—…','ì§„ë¡œ','ê³µë™ì²´'];const el=document.getElementById('pTop');el.classList.add('on');el.style.borderColor='#3182F6';el.style.background='#EBF4FF';el.querySelector('.tx').style.color='#3182F6'}
else if(t==='mid'){pri=['ì§„ë¡œ','í•™ì—…','ê³µë™ì²´'];const el=document.getElementById('pMid');el.classList.add('on');el.style.borderColor='#7B61FF';el.style.background='#F0EDFF';el.querySelector('.tx').style.color='#7B61FF'}
else{const el=document.getElementById('pCus');el.classList.add('on');el.style.borderColor='#4E5968';el.style.background='#F2F4F6';el.querySelector('.tx').style.color='#4E5968';document.getElementById('cusP').classList.remove('hidden');upP()}rPr()}
function upP(){const a=document.getElementById('p1').value,b=document.getElementById('p2').value,c=['í•™ì—…','ì§„ë¡œ','ê³µë™ì²´'].find(x=>x!==a&&x!==b)||'ê³µë™ì²´';document.getElementById('p3').innerHTML=`<option>${c}</option>`;pri=[a,b,c];rPr()}
function rPr(){document.getElementById('t1').textContent='1ìˆœìœ„ '+pri[0];document.getElementById('t2').textContent='2ìˆœìœ„ '+pri[1];document.getElementById('t3').textContent='3ìˆœìœ„ '+pri[2]}
function chk(){
const ready=!!(key&&pdf);
const btn=document.getElementById('goBtn');
btn.disabled=!ready;
console.log('[chk] key:',!!key,'pdf:',!!pdf,'ready:',ready);
if(!ready){
let msg=[];
if(!key)msg.push('API Key í•„ìš”');
if(!pdf)msg.push('PDF ì—…ë¡œë“œ í•„ìš”');
btn.textContent='âš ï¸ '+msg.join(' + ');
}else{
btn.textContent='ğŸ” AI ì¢…í•© ë¶„ì„ ì‹œì‘';
}
}

async function analyze(){
console.log('[analyze] ì‹œì‘');
const sid=getStuId()||'30101';
const nm=document.getElementById('sName').value.trim()||'í•™ìƒ';
const cr=document.getElementById('sCareer').value.trim()||'ë¯¸ì •';
const cl=document.getElementById('sClub').value.trim()||'ë¯¸ì •';
const me=document.getElementById('memo').value.trim();
const kw=[...selKW];const kc=document.getElementById('kwC').value.trim();if(kc)kw.push(...kc.split(',').map(s=>s.trim()).filter(Boolean));

// ì‚¬ì „ ê²€ì¦
if(!key){alert('âŒ API Keyë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”');return}
if(!pdf){alert('âŒ PDFë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”');return}

document.getElementById('pW').style.display='block';document.getElementById('goBtn').disabled=true;
showStatus('ğŸ“„ PDF ë¶„ì„ ì¤‘...',10);

try{
showStatus('ğŸ¤– AI ì‹¬ì¸µ ë¶„ì„ ì¤‘... (1~3ë¶„ ì†Œìš”, ì°½ì„ ë‹«ì§€ ë§ˆì„¸ìš”)',30);
console.log('[analyze] API í˜¸ì¶œ ì‹œì‘, pdfê¸¸ì´:',pdf.length,'keyì¡´ì¬:',!!key);

const model=getModel();
const prompt=bp(nm,cr,cl,kw,me);
console.log('[analyze] model:',model,'promptê¸¸ì´:',prompt.length);

let tx='';

showStatus('ğŸ¤– AI ë¶„ì„ ìš”ì²­ ì¤‘...',30);

const r=await fetch('https://api.anthropic.com/v1/messages',{
method:'POST',
headers:{
'Content-Type':'application/json',
'x-api-key':key,
'anthropic-version':'2023-06-01',
'anthropic-dangerous-direct-browser-access':'true'
},
body:JSON.stringify({
model:model,
max_tokens:16000,
stream:true,
messages:[{role:'user',content:prompt}]
})
});

if(!r.ok){
const errBody=await r.text();
console.error('[analyze] API ì—ëŸ¬:',r.status,errBody);
let em='API ì˜¤ë¥˜ ('+r.status+')';
try{const ej=JSON.parse(errBody);em=ej.error?.message||em}catch(x){}
throw new Error(em);
}

// ìŠ¤íŠ¸ë¦¬ë° ìˆ˜ì‹ 
showStatus('ğŸ¤– AI ë¶„ì„ ì¤‘... 0ì ìˆ˜ì‹ ',35);
const reader=r.body.getReader();
const decoder=new TextDecoder();
let buf='';
while(true){
const{done,value}=await reader.read();
if(done)break;
buf+=decoder.decode(value,{stream:true});
const lines=buf.split('\n');buf=lines.pop()||'';
for(const line of lines){
if(!line.startsWith('data:'))continue;
const dd=line.substring(5).trim();
if(dd==='[DONE]'||!dd)continue;
try{
const evt=JSON.parse(dd);
if(evt.type==='content_block_delta'&&evt.delta?.text){
tx+=evt.delta.text;
const pct=Math.min(35+Math.floor((tx.length/8000)*55),90);
showStatus('ğŸ¤– AI ë¶„ì„ ì¤‘... '+tx.length.toLocaleString()+'ì ìˆ˜ì‹ ',pct);
}
}catch(pe){}
}
}

console.log('[analyze] ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ, í…ìŠ¤íŠ¸ ê¸¸ì´:',tx.length);
showStatus('ğŸ“‹ ë³´ê³ ì„œ ìƒì„± ì¤‘... ('+tx.length.toLocaleString()+'ì)',92);

showStatus('ğŸ“‹ ë³´ê³ ì„œ ìƒì„± ì¤‘... (ì‘ë‹µ '+tx.length.toLocaleString()+'ì)',90);
cur=pr(tx,nm,cr,cl,sid,kw);
if(cur._err){console.warn('[analyze] JSON íŒŒì‹± ì‹¤íŒ¨, raw ì•ë¶€ë¶„:',tx.substring(0,200))}

// AIê°€ ì¶”ì¶œí•œ í•™ìƒ ì •ë³´ë¡œ ë¹ˆ í•„ë“œ ì±„ìš°ê¸°
if(!cur._err&&cur.student_info){
const si=cur.student_info;
console.log('[analyze] AI ì¶”ì¶œ student_info:',si);
if(si.name&&!document.getElementById('sName').value)document.getElementById('sName').value=si.name;
// í•™ë…„/ë°˜ì€ classInfoì—ì„œ ì´ë¯¸ ì„¤ì •ë¨ - ë®ì–´ì“°ì§€ ì•ŠìŒ
if(si.student_num&&!document.getElementById('sNo').value){
const noVal=parseInt(si.student_num);
if(noVal>=1&&noVal<=30)document.getElementById('sNo').value=String(noVal).padStart(2,'0');
}
if(si.career_hope&&!document.getElementById('sCareer').value)document.getElementById('sCareer').value=si.career_hope;
// ë™ì•„ë¦¬ëŠ” ìë™ì±„ì›€í•˜ì§€ ì•ŠìŒ (êµì‚¬ê°€ ì§ì ‘ ì…ë ¥)
updPreview();
// ì—…ë°ì´íŠ¸ëœ ì •ë³´ë¡œ ë©”íƒ€ ì¬ì„¤ì •
nm=document.getElementById('sName').value;
cr=document.getElementById('sCareer').value;
cl=document.getElementById('sClub').value;
sid=getStuId();
if(cur._m){cur._m.nm=nm;cur._m.cr=cr;cur._m.cl=cl;cur._m.sid=sid;}
}

stu[sid]={name:nm,career:cr,club:cl,sid,date:new Date().toLocaleDateString('ko-KR'),result:cur};
saveClassStudents();
rR(cur);rStu();updateBanner();showStatus('âœ… ë¶„ì„ ì™„ë£Œ!',100);
setTimeout(()=>{document.getElementById('pW').style.display='none';document.getElementById('goBtn').disabled=false},1500);

}catch(e){
console.error('[analyze] ì—ëŸ¬:',e);
showStatus('âŒ ì˜¤ë¥˜: '+e.message,0);
// ì—ëŸ¬ ì•Œë¦¼ë„ í‘œì‹œ
const errDiv=document.getElementById('errMsg');
if(errDiv){errDiv.textContent='âš ï¸ '+e.message;errDiv.style.display='block'}
document.getElementById('goBtn').disabled=false;
document.getElementById('goBtn').textContent='ğŸ” AI ì¢…í•© ë¶„ì„ ì‹œì‘ (ì¬ì‹œë„)';
}}
function showStatus(t,p){document.getElementById('pF').style.width=p+'%';document.getElementById('pT').textContent=t;console.log('[status]',p+'%',t)}
// spëŠ” showStatusë¡œ ëŒ€ì²´ë¨

// PDFì—ì„œ í•™ìƒ ì •ë³´ ìë™ ì¶”ì¶œ
function autoFillStudent(txt){
try{
console.log('[autoFill] PDF í…ìŠ¤íŠ¸ ì• 500ì:', txt.substring(0,500));

// === ì´ë¦„ ì¶”ì¶œ ===
const namePatterns=[
/ì„±\s*ëª…\s*[:\s]*([ê°€-í£]{2,4})/,
/ì´\s*ë¦„\s*[:\s]*([ê°€-í£]{2,4})/,
/ì„±ëª…\s*[:\s]*([ê°€-í£]{2,4})/,
/([ê°€-í£]{2,4})\s*í•™ìƒì˜?\s*(ì„±ì¥|í•™êµìƒí™œ|ìƒê¸°ë¶€|í•™ìƒë¶€)/,
/í•™\s*ì \s*ì‚¬\s*í•­[^ê°€-í£]*([ê°€-í£]{2,4})/,
/\d{5,6}\s*([ê°€-í£]{2,4})/,
/\d{1,2}\s*ë°˜\s*\d{1,2}\s*ë²ˆ?\s*([ê°€-í£]{2,4})/,
];
let foundName='';
for(const p of namePatterns){
const m=txt.match(p);
if(m&&m[1]&&m[1].length>=2&&m[1].length<=4){
foundName=m[1];
console.log('[autoFill] ì´ë¦„:',foundName);
break;
}
}
if(foundName)document.getElementById('sName').value=foundName;

// === ë²ˆí˜¸ë§Œ ì¶”ì¶œ (í•™ë…„/ë°˜ì€ classInfoì—ì„œ ì´ë¯¸ ì„¤ì •ë¨) ===
let foundNo='';
// íŒ¨í„´1: "3í•™ë…„ 2ë°˜ 15ë²ˆ" â†’ 15
const fullPat=[
/(\d)\s*í•™\s*ë…„\s*(\d{1,2})\s*ë°˜\s*(\d{1,2})\s*ë²ˆ/,
/(\d)-(\d{1,2})-(\d{1,2})/,
/(\d)í•™ë…„\s*(\d{1,2})ë°˜\s*(\d{1,2})ë²ˆ/,
];
for(const p of fullPat){
const m=txt.match(p);
if(m){foundNo=m[3];console.log('[autoFill] ë²ˆí˜¸(ì „ì²´íŒ¨í„´):',foundNo);break}
}
// íŒ¨í„´2: 5ìë¦¬ í•™ë²ˆ "30215" â†’ 15
if(!foundNo){
const sidMatch=txt.match(/(\d)(\d{2})(\d{2})\s*[ê°€-í£]{2,4}/);
if(sidMatch){foundNo=sidMatch[3];console.log('[autoFill] ë²ˆí˜¸(5ìë¦¬):',foundNo)}
}
// ë²ˆí˜¸ ì„¤ì •
if(foundNo){
const noVal=String(parseInt(foundNo)).padStart(2,'0');
if(parseInt(noVal)>=1&&parseInt(noVal)<=30){
document.getElementById('sNo').value=noVal;
}
updPreview();
}

// === ì§„ë¡œ ì¶”ì¶œ (ë™ì•„ë¦¬ëŠ” ìë™ì¶”ì¶œ ì•ˆ í•¨) ===
const careerPatterns=[
/í¬ë§\s*ì§„ë¡œ\s*[:\s]*([ê°€-í£a-zA-Z\s]{2,20})/,
/ì§„ë¡œ\s*í¬ë§\s*[:\s]*([ê°€-í£a-zA-Z\s]{2,20})/,
/ì¥ë˜\s*í¬ë§\s*[:\s]*([ê°€-í£a-zA-Z\s]{2,20})/,
/í¬ë§\s*í•™ê³¼\s*[:\s]*([ê°€-í£a-zA-Z\s]{2,20})/,
];
for(const p of careerPatterns){
const m=txt.match(p);
if(m&&m[1]){
const career=m[1].trim().replace(/\s{2,}/g,' ');
if(career.length>=2&&!/ì„ íƒ|ê³¼ëª©|ì´ìˆ˜|ë‹¨ìœ„|í•™ê¸°|êµê³¼/.test(career)){
document.getElementById('sCareer').value=career.substring(0,20);
console.log('[autoFill] ì§„ë¡œ:',career);
break;
}
}
}

chk();
const filled=[];
if(foundName)filled.push('ì´ë¦„');
if(foundNo)filled.push('ë²ˆí˜¸');
if(document.getElementById('sCareer').value)filled.push('ì§„ë¡œ');
if(filled.length){
const dz=document.getElementById('dz');
const sub=dz.querySelector('.dz-s');
if(sub){sub.style.display='';sub.textContent=`ìë™ì¶”ì¶œ: ${filled.join(', ')} âœ“`}
}

}catch(e){console.warn('[autoFill] ìë™ì¶”ì¶œ ì‹¤íŒ¨:',e)}
}

function bp(nm,cr,cl,kw,me){return`ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ê³ ë“±í•™êµ í•™êµìƒí™œê¸°ë¡ë¶€(ìƒê¸°ë¶€) ì „ë¬¸ ì»¨ì„¤í„´íŠ¸ì´ì ì…í•™ì‚¬ì •ê´€ ì¶œì‹  ë¶„ì„ê°€ì…ë‹ˆë‹¤.
15ë…„ ì´ìƒì˜ ê²½ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ, í•™ìƒì˜ 1~2í•™ë…„ ìƒê¸°ë¶€ë¥¼ ì‹¬ì¸µ ë¶„ì„í•˜ì—¬ 3í•™ë…„ ì „ëµì„ ìˆ˜ë¦½í•˜ëŠ” ìµœê³  ìˆ˜ì¤€ì˜ ë³´ê³ ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[í•™ìƒ ì •ë³´]
- ì´ë¦„: ${nm}
- í¬ë§ ì§„ë¡œ: ${cr}
- ë™ì•„ë¦¬: ${cl}
- í•µì‹¬ í‚¤ì›Œë“œ: ${kw.join(', ')||'ë¯¸ì§€ì •'}
${me?'- ë‹´ì„ ë©”ëª¨: '+me:''}
- ë³´ê³ ì„œ ìš°ì„ ìˆœìœ„: 1ìˆœìœ„ ${pri[0]} â†’ 2ìˆœìœ„ ${pri[1]} â†’ 3ìˆœìœ„ ${pri[2]}

[ë°”ì´íŠ¸ ì œí•œ - ë°˜ë“œì‹œ ì¤€ìˆ˜]
- ììœ¨í™œë™: 1500ë°”ì´íŠ¸ (í•œê¸€ 1ì=3ë°”ì´íŠ¸, ì˜ë¬¸/ìˆ«ì=1ë°”ì´íŠ¸)
- ì§„ë¡œí™œë™: 2100ë°”ì´íŠ¸
- ë™ì•„ë¦¬í™œë™: 1500ë°”ì´íŠ¸
- í–‰ë™íŠ¹ì„±ë°ì¢…í•©ì˜ê²¬: 1500ë°”ì´íŠ¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[í•™ìƒ ìƒê¸°ë¶€ ì›ë¬¸]
${pdf.substring(0,30000)}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[ë¶„ì„ ì§€ì¹¨ - ë§¤ìš° ì¤‘ìš”]

0. **í•™ìƒ ê¸°ë³¸ì •ë³´ ì¶”ì¶œ(student_info)** - ìƒê¸°ë¶€ ì›ë¬¸ì—ì„œ ì•„ë˜ ì •ë³´ë¥¼ ì°¾ì•„ ì±„ì›Œì£¼ì„¸ìš”:
   - name: í•™ìƒ ì´ë¦„
   - grade: í•™ë…„ (ìˆ«ìë§Œ, ì˜ˆ: "3")
   - class_num: ë°˜ (ìˆ«ìë§Œ, ì˜ˆ: "2")
   - student_num: ë²ˆí˜¸ (ìˆ«ìë§Œ, ì˜ˆ: "15")
   - career_hope: í¬ë§ ì§„ë¡œ/ì¥ë˜í¬ë§ (ìƒê¸°ë¶€ì— ê¸°ì¬ëœ ë‚´ìš©)
   - club: ë™ì•„ë¦¬ëª… (ê°€ì¥ ìµœê·¼ ë˜ëŠ” ì£¼ìš” ë™ì•„ë¦¬)

1. **ì¢…í•© ë¶„ì„(overview)**
   - summary: í•™ìƒì˜ ì „ì²´ì ì¸ ì„±ì¥ ì„œì‚¬ë¥¼ 4~6ë¬¸ì¥ìœ¼ë¡œ í’ë¶€í•˜ê²Œ ìš”ì•½. "ì´ í•™ìƒì€ 1í•™ë…„ì—ì„œ ~~, 2í•™ë…„ì—ì„œ ~~ë¡œ ë°œì „í–ˆìœ¼ë©°, ~~ë¼ëŠ” ì ì—ì„œ ì£¼ëª©í•  ë§Œí•˜ë‹¤" ìˆ˜ì¤€ì˜ êµ¬ì²´ì  ì„œìˆ 
   - strengths: ìƒê¸°ë¶€ì—ì„œ ì‹¤ì œë¡œ í™•ì¸ë˜ëŠ” êµ¬ì²´ì  í™œë™/ì„±ê³¼ë¥¼ ê·¼ê±°ë¡œ 3~5ê°œ ê°•ì  ì„œìˆ  (ê° ê°•ì ì„ 2~3ë¬¸ì¥ìœ¼ë¡œ êµ¬ì²´ì ìœ¼ë¡œ)
   - improvements: í˜„ì¬ ìƒê¸°ë¶€ì—ì„œ ë¶€ì¡±í•˜ê±°ë‚˜ 3í•™ë…„ì—ì„œ ë³´ì™„í•´ì•¼ í•  ì  2~3ê°œ (êµ¬ì²´ì  ëŒ€ì•ˆ í¬í•¨)
   - competencies: 4ëŒ€ ì—­ëŸ‰(ì§„ë¡œ/í•™ì—…/ê³µë™ì²´/ì¸ì„±) ê°ê°ì— ëŒ€í•´:
     * grade1: 1í•™ë…„ ë•Œì˜ ì—­ëŸ‰ ìˆ˜ì¤€ì„ êµ¬ì²´ì  í™œë™ ì‚¬ë¡€ì™€ í•¨ê»˜ 3~4ë¬¸ì¥ìœ¼ë¡œ ì„œìˆ 
     * grade2: 2í•™ë…„ ë•Œì˜ ì—­ëŸ‰ ìˆ˜ì¤€ì„ êµ¬ì²´ì  í™œë™ ì‚¬ë¡€ì™€ í•¨ê»˜ 3~4ë¬¸ì¥ìœ¼ë¡œ ì„œìˆ 
     * growth: 1â†’2í•™ë…„ ì„±ì¥ ê³¼ì •ê³¼ ì˜ë¯¸ë¥¼ 3~4ë¬¸ì¥ìœ¼ë¡œ ë¶„ì„

2. **ììœ¨/ì§„ë¡œ/ë™ì•„ë¦¬/í–‰ë°œ(jarhaeng)** - ì´ê²ƒì´ ê°€ì¥ ì¤‘ìš”!
   - evaluation: í˜„ì¬ í•´ë‹¹ ì˜ì—­ì˜ ê¸°ë¡ ìˆ˜ì¤€ í‰ê°€ ë° 3í•™ë…„ ë°©í–¥ (3~4ë¬¸ì¥)
   - option1, option2: ê°ê° ì„œë¡œ ë‹¤ë¥¸ ê´€ì (ìš°ì„ ìˆœìœ„ ê¸°ë°˜)ì—ì„œ ì‘ì„±í•œ **ì‹¤ì œ ìƒê¸°ë¶€ ê¸°ì¬ ì˜ˆì‹œë¬¸**
     * text: ë°˜ë“œì‹œ ë°”ì´íŠ¸ ì œí•œì— ë§ëŠ” **ì™„ì„±ëœ ìƒê¸°ë¶€ ë¬¸ì¥**ì„ ì‘ì„±. êµì‚¬ê°€ ë°”ë¡œ ë³µì‚¬í•´ì„œ ì“¸ ìˆ˜ ìˆëŠ” ìˆ˜ì¤€.
       - êµ¬ì²´ì  í™œë™ëª…, ì—­í• , ê³¼ì •, ê²°ê³¼, ì„±ì¥ì„ í¬í•¨
       - "~í•¨", "~ì„ ë³´ì„" ë“± ìƒê¸°ë¶€ ë¬¸ì²´ ì‚¬ìš©
       - í•™ìƒì˜ ì‹¤ì œ 1,2í•™ë…„ í™œë™ê³¼ ì—°ê³„í•˜ì—¬ 3í•™ë…„ í™œë™ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ê°€ëŠ” ì„œì‚¬
       - ì¶”ìƒì  í‘œí˜„ ê¸ˆì§€. êµ¬ì²´ì  ìˆ˜ì¹˜, í™œë™ëª…, ì´ë¡ ëª…, ë„êµ¬ëª… ë“±ì„ ë°˜ë“œì‹œ í¬í•¨
     * title: ì´ ê¸°ì¬ë¬¸ì˜ í•µì‹¬ ë°©í–¥ (ì˜ˆ: "í•™ì—…ì—­ëŸ‰ ì¤‘ì‹¬ ì„œìˆ ", "ì§„ë¡œíƒêµ¬ ì‹¬í™” ì„œìˆ ")
     * focus: ì´ ê¸°ì¬ë¬¸ì˜ ê°•ì  í¬ì¸íŠ¸ (1~2ë¬¸ì¥)
     * supplement: ì´ ê¸°ì¬ë¬¸ì—ì„œ ë” ë³´ì™„í•˜ë©´ ì¢‹ì„ ì  (1~2ë¬¸ì¥)

3. **ì„¸íŠ¹ ë°©í–¥(setuk)**
   - direction: 3í•™ë…„ ì„¸íŠ¹ì˜ ì „ì²´ì  ë°©í–¥ì„± (3~4ë¬¸ì¥, 1,2í•™ë…„ íë¦„ê³¼ ì—°ê³„)
   - subjects: 3~5ê°œ ê³¼ëª©ë³„ë¡œ:
     * name: ê³¼ëª©ëª…
     * theme: êµ¬ì²´ì  íƒêµ¬ ì£¼ì œ (ì˜ˆ: "í–‰ë™ê²½ì œí•™ì˜ ë„›ì§€ ì´ë¡ ì„ í™œìš©í•œ êµë‚´ ì—ë„ˆì§€ ì ˆì•½ ìº í˜ì¸ íš¨ê³¼ ë¶„ì„")
     * reason: ì™œ ì´ ì£¼ì œê°€ ì´ í•™ìƒì—ê²Œ ì í•©í•œì§€ (2~3ë¬¸ì¥, 1,2í•™ë…„ í™œë™ê³¼ì˜ ì—°ê³„ì„± ì„¤ëª…)
     * keywords: í•µì‹¬ í‚¤ì›Œë“œ 3~5ê°œ

4. **ë™ì•„ë¦¬ ê³„íš(club)**
   - name: ë™ì•„ë¦¬ëª…
   - goal: ë™ì•„ë¦¬ í™œë™ì˜ í•µì‹¬ ëª©í‘œ (3~4ë¬¸ì¥, í•™ìƒì˜ ì§„ë¡œì™€ ì—°ê³„)
   - monthly: 3~11ì›” ê° ì›”ë³„ë¡œ:
     * activity: í•´ë‹¹ ì›”ì˜ êµ¬ì²´ì  í™œë™ ë‚´ìš© (2~3ë¬¸ì¥)
     * record: ìƒê¸°ë¶€ì— ê¸°ë¡í•  í¬ì¸íŠ¸ (1~2ë¬¸ì¥)

5. **ìƒë‹´ ê°€ì´ë“œ(counsel)**
   - talk_points: ë‹´ì„ì´ ì´ í•™ìƒê³¼ ìƒë‹´ ì‹œ ë‹¤ë¤„ì•¼ í•  í•µì‹¬ í¬ì¸íŠ¸ 3~5ê°œ (ê° 2ë¬¸ì¥ ì´ìƒ)
   - questions: í•™ìƒì—ê²Œ ë˜ì§ˆ êµ¬ì²´ì  ìƒë‹´ ì§ˆë¬¸ 3~5ê°œ
   - parent_points: í•™ë¶€ëª¨ ìƒë‹´ ì‹œ ì „ë‹¬í•  í•µì‹¬ ë‚´ìš© 2~3ê°œ (ê° 2ë¬¸ì¥ ì´ìƒ)
   - recommended_activities: 3í•™ë…„ì—ì„œ ì¶”ì²œí•˜ëŠ” êµ¬ì²´ì  í™œë™ 3~5ê°œ (ê° í™œë™ì˜ ëª©ì ê³¼ ë°©ë²• í¬í•¨)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[í•„ìˆ˜ ì¶œë ¥ ê·œì¹™]
- { ë¡œ ì‹œì‘í•´ì„œ } ë¡œ ëë‚˜ëŠ” ìˆœìˆ˜ JSONë§Œ ì¶œë ¥í•  ê²ƒ
- ì½”ë“œë¸”ë¡ ë§ˆì»¤, ì„¤ëª… í…ìŠ¤íŠ¸, ë§ˆí¬ë‹¤ìš´ ë“± ì ˆëŒ€ ê¸ˆì§€. ì˜¤ì§ JSON ê°ì²´ë§Œ ì¶œë ¥
- ëª¨ë“  í…ìŠ¤íŠ¸ í•„ë“œëŠ” í’ë¶€í•˜ê³  êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„± (ë¹ˆ ë¬¸ìì—´ "" ì ˆëŒ€ ê¸ˆì§€)
- jarhaengì˜ text í•„ë“œëŠ” ë°˜ë“œì‹œ ë°”ì´íŠ¸ ì œí•œì„ ì¤€ìˆ˜í•˜ë©´ì„œë„ ë‚´ìš©ì´ í’ë¶€í•´ì•¼ í•¨
- í•™ìƒì˜ ì‹¤ì œ ìƒê¸°ë¶€ì— ì–¸ê¸‰ëœ í™œë™, ê³¼ëª©, ì„±ê³¼ë¥¼ ë°˜ë“œì‹œ ì°¸ì¡°í•˜ì—¬ ì‘ì„±

[JSON êµ¬ì¡°]
{"student_info":{"name":"","grade":"","class_num":"","student_num":"","career_hope":"","club":""},"overview":{"summary":"","strengths":["","",""],"improvements":["",""],"competencies":{"career":{"grade1":"","grade2":"","growth":""},"academic":{"grade1":"","grade2":"","growth":""},"community":{"grade1":"","grade2":"","growth":""},"character":{"grade1":"","grade2":"","growth":""}}},"jarhaeng":{"jayul":{"evaluation":"","option1":{"title":"${pri[0]}ì¤‘ì‹¬","text":"","focus":"","supplement":""},"option2":{"title":"${pri[1]}ì¤‘ì‹¬","text":"","focus":"","supplement":""}},"jinro":{"evaluation":"","option1":{"title":"${pri[0]}ì¤‘ì‹¬","text":"","focus":"","supplement":""},"option2":{"title":"${pri[1]}ì¤‘ì‹¬","text":"","focus":"","supplement":""}},"dongari":{"evaluation":"","option1":{"title":"${pri[0]}ì¤‘ì‹¬","text":"","focus":"","supplement":""},"option2":{"title":"${pri[1]}ì¤‘ì‹¬","text":"","focus":"","supplement":""}},"hangbal":{"evaluation":"","option1":{"title":"${pri[0]}ì¤‘ì‹¬","text":"","focus":"","supplement":""},"option2":{"title":"${pri[1]}ì¤‘ì‹¬","text":"","focus":"","supplement":""}}},"setuk":{"direction":"","subjects":[{"name":"","theme":"","reason":"","keywords":[]}]},"club":{"name":"","goal":"","monthly":[{"month":"3ì›”","activity":"","record":""},{"month":"4ì›”","activity":"","record":""},{"month":"5ì›”","activity":"","record":""},{"month":"6ì›”","activity":"","record":""},{"month":"7ì›”","activity":"","record":""},{"month":"8ì›”","activity":"","record":""},{"month":"9ì›”","activity":"","record":""},{"month":"10ì›”","activity":"","record":""},{"month":"11ì›”","activity":"","record":""}]},"counsel":{"talk_points":[],"questions":[],"parent_points":[],"recommended_activities":[]}}`}

function pr(tx,nm,cr,cl,sid,kw){
function makeMeta(){return{nm,cr,cl,sid,kw,pri:[...pri],dt:new Date().toLocaleDateString('ko-KR')}}

// ë¹ˆ í…ìŠ¤íŠ¸ ì²´í¬
if(!tx||tx.trim().length<10){
console.error('[pr] ë¹ˆ í…ìŠ¤íŠ¸');
return{_m:makeMeta(),_raw:tx||'(ë¹ˆ ì‘ë‹µ)',_err:true};
}

function extractJSON(str){
str=str.replace(/```json\s*/gi,'').replace(/```\s*/g,'').replace(/^\s*json\s*/i,'').trim();
const s=str.indexOf('{'),e=str.lastIndexOf('}');
if(s<0||e<=s)return null;
return str.substring(s,e+1);
}

// 1ì°¨: ê¸°ë³¸ íŒŒì‹±
try{
let c=extractJSON(tx);
if(c){const o=JSON.parse(c);o._m=makeMeta();console.log('[pr] 1ì°¨ ì„±ê³µ');return o}
}catch(e1){console.log('[pr] 1ì°¨ ì‹¤íŒ¨:',e1.message)}

// 2ì°¨: ë¬¸ìì—´ ë‚´ë¶€ ì¤„ë°”ê¿ˆ â†’ ê³µë°±
try{
let c=extractJSON(tx);
if(c){
c=c.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,'');
let result='',inStr=false,prev='';
for(let i=0;i<c.length;i++){
const ch=c[i];
if(ch==='"'&&prev!=='\\')inStr=!inStr;
if(inStr&&(ch==='\n'||ch==='\r'||ch==='\t')){result+=' ';prev=ch;continue}
result+=ch;prev=ch;
}
const o=JSON.parse(result);o._m=makeMeta();console.log('[pr] 2ì°¨ ì„±ê³µ');return o;
}
}catch(e2){console.log('[pr] 2ì°¨ ì‹¤íŒ¨:',e2.message)}

// 3ì°¨: ëª¨ë“  ì¤„ë°”ê¿ˆ/ì œì–´ë¬¸ì ì œê±°
try{
let c=extractJSON(tx);
if(c){
c=c.replace(/[\r\n\t]/g,' ').replace(/\s{2,}/g,' ').replace(/[\x00-\x1F\x7F]/g,'');
const o=JSON.parse(c);o._m=makeMeta();console.log('[pr] 3ì°¨ ì„±ê³µ');return o;
}
}catch(e3){console.log('[pr] 3ì°¨ ì‹¤íŒ¨:',e3.message)}

// 4ì°¨: ë¬¸ìì—´ ê°’ ì•ˆì˜ ì´ìŠ¤ì¼€ì´í”„ ì•ˆ ëœ ë”°ì˜´í‘œ ìˆ˜ì •
try{
let c=extractJSON(tx);
if(c){
c=c.replace(/[\r\n\t]/g,' ').replace(/\s{2,}/g,' ').replace(/[\x00-\x1F\x7F]/g,'');
// ë¬¸ìì—´ ê°’ ì•ˆì˜ " â†’ \\"ë¡œ ë³€í™˜ (ê°„ë‹¨í•œ ìƒíƒœë¨¸ì‹ )
let fixed='',inS=false,i=0;
while(i<c.length){
const ch=c[i];
if(!inS&&ch==='"'){fixed+=ch;inS=true;i++;continue}
if(inS&&ch==='\\'&&i+1<c.length){fixed+=ch+c[i+1];i+=2;continue}
if(inS&&ch==='"'){
// ë‹¤ìŒ ë¬¸ìê°€ :,}] ë˜ëŠ” ê³µë°±+:,}] ì´ë©´ ë¬¸ìì—´ ë
const rest=c.substring(i+1).trimStart();
if(!rest||/^[,:}\]]/.test(rest)){fixed+=ch;inS=false;i++;continue}
// ì•„ë‹ˆë©´ ë¬¸ìì—´ ì•ˆì˜ ë”°ì˜´í‘œ â†’ ì´ìŠ¤ì¼€ì´í”„
fixed+='\\"';i++;continue;
}
fixed+=ch;i++;
}
const o=JSON.parse(fixed);o._m=makeMeta();console.log('[pr] 4ì°¨ ì„±ê³µ(ë”°ì˜´í‘œ ìˆ˜ì •)');return o;
}
}catch(e4){console.log('[pr] 4ì°¨ ì‹¤íŒ¨:',e4.message)}

// 5ì°¨: ìµœí›„ì˜ ìˆ˜ë‹¨ - í•µì‹¬ í•„ë“œë§Œ ì •ê·œì‹ìœ¼ë¡œ ì¶”ì¶œ
try{
console.log('[pr] 5ì°¨ ì‹œë„ - ì •ê·œì‹ ì¶”ì¶œ');
const raw=tx;
const getSafe=(key)=>{
const re=new RegExp('"'+key+'"\\s*:\\s*"((?:[^"\\\\]|\\\\.)*)"');
const m=raw.match(re);
return m?m[1].replace(/\\"/g,'"').replace(/\\n/g,' '):'';
};
const getArr=(key)=>{
const re=new RegExp('"'+key+'"\\s*:\\s*\\[(.*?)\\]','s');
const m=raw.match(re);
if(!m)return[];
return(m[1].match(/"((?:[^"\\\\]|\\\\.)*)"/g)||[]).map(s=>s.replace(/^"|"$/g,'').replace(/\\"/g,'"'));
};
const o={
student_info:{name:getSafe('name'),career_hope:getSafe('career_hope'),club:getSafe('club')},
overview:{summary:getSafe('summary'),strengths:getArr('strengths'),improvements:getArr('improvements'),
competencies:{
career:{grade1:getSafe('grade1'),grade2:getSafe('grade2'),growth:getSafe('growth')},
academic:{grade1:'',grade2:'',growth:''},community:{grade1:'',grade2:'',growth:''},character:{grade1:'',grade2:'',growth:''}
}},
jarhaeng:{jayul:{evaluation:'',option1:{title:'',text:'',focus:'',supplement:''},option2:{title:'',text:'',focus:'',supplement:''}},
jinro:{evaluation:'',option1:{title:'',text:'',focus:'',supplement:''},option2:{title:'',text:'',focus:'',supplement:''}},
dongari:{evaluation:'',option1:{title:'',text:'',focus:'',supplement:''},option2:{title:'',text:'',focus:'',supplement:''}},
hangbal:{evaluation:'',option1:{title:'',text:'',focus:'',supplement:''},option2:{title:'',text:'',focus:'',supplement:''}}},
setuk:{direction:getSafe('direction'),subjects:[]},
club:{name:'',goal:'',monthly:[]},
counsel:{talk_points:getArr('talk_points'),questions:getArr('questions'),parent_points:[],recommended_activities:[]}
};
if(o.overview.summary){o._m=makeMeta();o._partial=true;console.log('[pr] 5ì°¨ ì„±ê³µ(ë¶€ë¶„ ì¶”ì¶œ)');return o}
}catch(e5){console.log('[pr] 5ì°¨ ì‹¤íŒ¨:',e5.message)}

console.error('[pr] ëª¨ë“  íŒŒì‹± ì‹œë„ ì‹¤íŒ¨');
return{_m:makeMeta(),_raw:tx,_err:true};
}

function rR(r){
document.getElementById('resS').style.display='block';
const el=document.getElementById('resContent');

if(r._err){
const rawLen=(r._raw||'').length;
const rawPreview=esc((r._raw||'').substring(0,500));
el.innerHTML=`<div class="res-sec"><h3>âš ï¸ íŒŒì‹± ì‹¤íŒ¨</h3>
<p style="margin-bottom:10px;color:var(--coral);font-weight:600">AI ì‘ë‹µì„ JSONìœ¼ë¡œ ë³€í™˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
<p style="font-size:12px;color:var(--g3);margin-bottom:10px">ì‘ë‹µ ê¸¸ì´: ${rawLen}ì | ì½˜ì†”(F12)ì—ì„œ ìƒì„¸ ì˜¤ë¥˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<details><summary style="cursor:pointer;color:var(--g3);font-size:12px;font-weight:600">â–¶ ì›ë¬¸ ë³´ê¸° (ì• 500ì)</summary>
<pre style="white-space:pre-wrap;font-size:11px;color:var(--g3);margin-top:8px;max-height:400px;overflow:auto;padding:12px;background:var(--g7);border-radius:8px">${rawPreview}${rawLen>500?'\n\n... ('+rawLen+'ì ì¤‘ 500ìë§Œ í‘œì‹œ)':''}</pre></details>

<button class="btn btn-blue btn-sm" onclick="analyze()" style="margin-top:12px">ğŸ”„ ë‹¤ì‹œ ì‹œë„</button>

</div>`;
return;
}

const m=r._m||{},ov=r.overview||{},cp=ov.competencies||{},jh=r.jarhaeng||{},se=r.setuk||{},club=r.club||{},co=r.counsel||{};
const compMeta=[
{k:â€˜careerâ€™,l:â€˜ì§„ë¡œì—­ëŸ‰â€™,cls:â€™â€™,color:â€™#3182F6â€™},
{k:â€˜academicâ€™,l:â€˜í•™ì—…ì—­ëŸ‰â€™,cls:â€˜purpleâ€™,color:â€™#7B61FFâ€™},
{k:â€˜communityâ€™,l:â€˜ê³µë™ì²´ì—­ëŸ‰â€™,cls:â€˜green-câ€™,color:â€™#00C471â€™},
{k:â€˜characterâ€™,l:â€˜ì¸ì„±ì—­ëŸ‰â€™,cls:â€˜orangeâ€™,color:â€™#FF9F43â€™}
];
const jhMeta=[
{k:â€˜jayulâ€™,l:â€˜ììœ¨í™œë™â€™,lm:1500},
{k:â€˜jinroâ€™,l:â€˜ì§„ë¡œí™œë™â€™,lm:2100},
{k:â€˜dongariâ€™,l:â€˜ë™ì•„ë¦¬í™œë™â€™,lm:1500},
{k:â€˜hangbalâ€™,l:â€˜í–‰ë™íŠ¹ì„±ë°ì¢…í•©ì˜ê²¬â€™,lm:1500}
];

let html=â€™â€™;

// === í—¤ë” ===
html+=`<div class="res-header">

<h2>ğŸ“Š ${m.nm||'í•™ìƒ'} ì„±ì¥ë¶„ì„ ë³´ê³ ì„œ</h2>
<div class="res-info">
<div>ğŸ“‹ <span>${m.sid||''}</span></div>
<div>ğŸ¯ ì§„ë¡œ: <span>${m.cr||''}</span></div>
<div>ğŸ« ë™ì•„ë¦¬: <span>${m.cl||''}</span></div>
<div>ğŸ“… <span>${m.dt||''}</span></div>
<div>âš¡ <span>${(m.pri||[]).map((p,i)=>['â‘ ','â‘¡','â‘¢'][i]+p).join(' â†’ ')}</span></div>
</div></div>`;

// === ì¢…í•© ë¶„ì„ ===
html+=`<div class="res-sec"><h3>ğŸ“Š ì¢…í•© ë¶„ì„</h3>

<div class="res-summary">${ov.summary||'ë¶„ì„ ê²°ê³¼ ì—†ìŒ'}</div>
<div class="res-chips">${(ov.strengths||[]).map(s=>`<div class="chip-s green">âœ¦ ${s}</div>`).join('')}</div>
<div class="res-chips">${(ov.improvements||[]).map(s=>`<div class="chip-s coral">â†’ ${s}</div>`).join('')}</div>
</div>`;

// === 4ëŒ€ ì—­ëŸ‰ ===
html+=`<div class="res-sec"><h3>ğŸ’ª 4ëŒ€ ì—­ëŸ‰ ë¶„ì„</h3><div class="comp-grid">`;
compMeta.forEach(cm=>{
const c=cp[cm.k]||{};
html+=`<div class="comp-card ${cm.cls}" style="border-left-color:${cm.color}">

<div class="comp-label" style="color:${cm.color}">${cm.l}</div>
<div class="comp-row"><div class="tag">1í•™ë…„</div><div>${c.grade1||'-'}</div></div>
<div class="comp-row"><div class="tag">2í•™ë…„</div><div>${c.grade2||'-'}</div></div>
<div class="comp-row"><div class="tag" style="color:${cm.color}">ì„±ì¥</div><div style="font-weight:600">${c.growth||'-'}</div></div>
</div>`;
});
html+=`</div></div>`;

// === ììœ¨Â·ì§„ë¡œÂ·ë™ì•„ë¦¬Â·í–‰ë°œ ===
html+=`<div class="res-sec"><h3>ğŸ“ ììœ¨Â·ì§„ë¡œÂ·ë™ì•„ë¦¬Â·í–‰ë°œ ê¸°ì¬ ì˜ˆì‹œ</h3>`;
jhMeta.forEach(a=>{
const d=jh[a.k]||{},o1=d.option1||{},o2=d.option2||{};
const b1=bl(o1.text||â€™â€™),b2=bl(o2.text||â€™â€™);
html+=`<div class="opt-area-title">${a.l} <span class="byte-badge">${a.lm}B</span></div>

<div class="opt-eval">${d.evaluation||''}</div>
<div class="opt-pair">
<div class="opt-box">
<div class="opt-head"><span class="opt-badge b1">1ì•ˆ</span> ${o1.title||''} <span class="byte-info ${b1>a.lm?'over':''}">${b1}/${a.lm}B</span></div>
<div class="opt-text">${o1.text||''}</div>
<div class="opt-tip">âœ“ ${o1.focus||''} Â· â†’ ${o1.supplement||''}</div>
</div>
<div class="opt-box">
<div class="opt-head"><span class="opt-badge b2">2ì•ˆ</span> ${o2.title||''} <span class="byte-info ${b2>a.lm?'over':''}">${b2}/${a.lm}B</span></div>
<div class="opt-text">${o2.text||''}</div>
<div class="opt-tip">âœ“ ${o2.focus||''} Â· â†’ ${o2.supplement||''}</div>
</div>
</div>`;
});
html+=`</div>`;

// === ì„¸íŠ¹ ===
html+=`<div class="res-sec"><h3>ğŸ¯ 3í•™ë…„ ì„¸íŠ¹ ë°©í–¥</h3>

<div class="res-summary">${se.direction||''}</div>`;
(se.subjects||[]).forEach(s=>{
html+=`<div class="setuk-card"><div class="setuk-name">${s.name||''}</div>
<div class="setuk-theme">ğŸ“Œ ${s.theme||''}</div>
<div class="setuk-reason">${s.reason||''}</div>
<div class="setuk-kws">${(s.keywords||[]).map(k=>`<span class="kw-tag">${k}</span>`).join(' ')}</div></div>`;
});
html+=`</div>`;

// === ë™ì•„ë¦¬ ===
html+=`<div class="res-sec"><h3>ğŸ« ë™ì•„ë¦¬ ì›”ë³„ ê³„íš</h3>

<div class="res-summary">${club.goal||''}</div>
<table class="club-tbl"><tr><th style="width:60px">ì›”</th><th>í™œë™ ë‚´ìš©</th><th>ê¸°ë¡ í¬ì¸íŠ¸</th></tr>`;
(club.monthly||[]).forEach(m=>{
html+=`<tr><td style="font-weight:700;color:var(--blue)">${m.month}</td><td>${m.activity||''}</td><td style="font-size:11px;color:var(--g3)">${m.record||''}</td></tr>`;
});
html+=`</table></div>`;

// === ìƒë‹´ ===
html+=`<div class="res-sec"><h3>ğŸ’¬ ìƒë‹´ ê°€ì´ë“œ</h3>

<div class="co-card"><h4>ğŸ’¬ ìƒë‹´ í¬ì¸íŠ¸</h4>${(co.talk_points||[]).map(s=>`<p>â€¢ ${s}</p>`).join('')}</div>
<div class="co-card"><h4>â“ ì§ˆë¬¸ ì˜ˆì‹œ</h4>${(co.questions||[]).map(s=>`<p>"${s}"</p>`).join('')}</div>
<div class="co-card"><h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ í•™ë¶€ëª¨ ìƒë‹´</h4>${(co.parent_points||[]).map(s=>`<p>â€¢ ${s}</p>`).join('')}</div>
<div class="co-card"><h4>ğŸš€ ì¶”ì²œ í™œë™</h4>${(co.recommended_activities||[]).map(s=>`<p>âœ¦ ${s}</p>`).join('')}</div>
</div>`;

el.innerHTML=html;
}

function bl(s){return new Blob([s||â€™â€™]).size}
function esc(s){return s.replace(/&/g,â€™&â€™).replace(/</g,â€™<â€™).replace(/>/g,â€™>â€™)}

function getPDFStyles(){return`<style> @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap'); *{margin:0;padding:0;box-sizing:border-box} body{font-family:'Noto Sans KR',sans-serif;max-width:860px;margin:0 auto;padding:40px 32px;color:#191F28;line-height:1.7;font-size:13px;background:#fff} .cover{text-align:center;padding:40px 0 30px;border-bottom:3px solid #3182F6;margin-bottom:30px} .cover h1{font-size:28px;font-weight:900;color:#3182F6;letter-spacing:-1px} .cover .sub{font-size:14px;color:#8B95A1;margin-top:8px} .info-bar{display:flex;gap:12px;flex-wrap:wrap;margin:20px 0;padding:16px 20px;background:linear-gradient(135deg,#EBF4FF,#F0EDFF);border-radius:14px} .info-item{font-size:13px;font-weight:600;color:#333D4B}.info-item span{color:#3182F6} .section{margin:28px 0;page-break-inside:avoid} h2{font-size:18px;font-weight:800;color:#191F28;margin:30px 0 16px;padding-bottom:8px;border-bottom:2px solid #E5E8EB;display:flex;align-items:center;gap:8px} h3{font-size:15px;font-weight:700;color:#333D4B;margin:20px 0 10px;display:flex;align-items:center;gap:8px} .byte-tag{font-size:11px;background:#F2F4F6;color:#8B95A1;padding:2px 8px;border-radius:100px;font-weight:600} .summary{font-size:14px;line-height:1.85;color:#333D4B;padding:18px 20px;background:#F8F9FA;border-radius:12px;border-left:4px solid #3182F6;margin:12px 0} .chips{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0} .chip-good{padding:8px 14px;background:#E8FAF0;color:#00C471;border-radius:10px;font-size:12px;font-weight:600} .chip-imp{padding:8px 14px;background:#FFF0F0;color:#FF6B6B;border-radius:10px;font-size:12px;font-weight:600} .comp-card{background:#FAFBFC;border-radius:12px;padding:16px 18px;margin:10px 0} .comp-title{font-size:14px;font-weight:800;margin-bottom:8px} .comp-tbl{width:100%;font-size:12px;line-height:1.7} .comp-tbl th{text-align:left;padding:6px 10px;color:#8B95A1;font-weight:600;vertical-align:top} .comp-tbl td{padding:6px 10px;color:#4E5968} .eval{font-size:13px;color:#4E5968;line-height:1.7;padding:10px 14px;background:#FAFBFC;border-radius:8px;margin-bottom:12px} .opt-grid{display:grid;gap:10px} .opt-box{border-radius:12px;padding:16px;border:1px solid #E5E8EB;background:#fff} .opt-hdr{font-size:13px;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap} .opt-badge{padding:3px 10px;border-radius:100px;font-size:11px;font-weight:700;color:#fff} .opt-badge.blue{background:#3182F6}.opt-badge.purple{background:#7B61FF} .byte-count{font-size:11px;font-weight:600;color:#8B95A1;margin-left:auto}.byte-count.over{color:#FF6B6B} .opt-body{font-size:13px;color:#333D4B;line-height:1.8;white-space:pre-wrap;padding:12px 14px;background:#F8F9FA;border-radius:8px} .opt-meta{font-size:11px;color:#8B95A1;margin-top:8px;font-weight:500} .setuk-card{padding:14px 16px;background:#FAFBFC;border-radius:10px;margin:8px 0;border:1px solid #E5E8EB} .setuk-name{font-size:14px;font-weight:800;color:#3182F6} .setuk-theme{font-size:13px;font-weight:600;color:#333D4B;margin:6px 0} .setuk-reason{font-size:12px;color:#4E5968;line-height:1.7} .setuk-kws{margin-top:8px}.kw-tag{display:inline-block;padding:3px 10px;background:#EBF4FF;color:#3182F6;border-radius:100px;font-size:11px;font-weight:600;margin:2px} .club-tbl{width:100%;border-collapse:separate;border-spacing:0;border-radius:10px;overflow:hidden;border:1px solid #E5E8EB;font-size:12px} .club-tbl th{padding:10px 14px;background:#F2F4F6;font-weight:700;text-align:left;color:#4E5968} .club-tbl td{padding:10px 14px;border-top:1px solid #E5E8EB;color:#333D4B;line-height:1.65} .co-sec{margin:14px 0;padding:14px 16px;background:#FAFBFC;border-radius:10px} .co-sec h4{font-size:13px;font-weight:700;margin-bottom:8px;color:#333D4B} .co-sec p{font-size:12px;color:#4E5968;line-height:1.7;margin:4px 0} .footer{text-align:center;margin-top:40px;padding-top:16px;border-top:2px solid #E5E8EB;font-size:11px;color:#B0B8C1} @media print{body{padding:20px 16px;font-size:12px}.cover{padding:20px 0 16px}.comp-card,.opt-box,.setuk-card{break-inside:avoid}} </style>`}

function buildPDFContent(result){
const r=result,m=r._m||{},ov=r.overview||{},cp=ov.competencies||{},jh=r.jarhaeng||{},se=r.setuk||{},cl=r.club||{},co=r.counsel||{};
const compLabels={career:â€˜ì§„ë¡œì—­ëŸ‰â€™,academic:â€˜í•™ì—…ì—­ëŸ‰â€™,community:â€˜ê³µë™ì²´ì—­ëŸ‰â€™,character:â€˜ì¸ì„±ì—­ëŸ‰â€™};
const compColors={career:â€™#3182F6â€™,academic:â€™#7B61FFâ€™,community:â€™#00C471â€™,character:â€™#FF9F43â€™};
let compHtml=â€™â€™;
[â€˜careerâ€™,â€˜academicâ€™,â€˜communityâ€™,â€˜characterâ€™].forEach(k=>{
const c=cp[k]||{};
compHtml+=`<div class="comp-card" style="border-left:4px solid ${compColors[k]}">

<div class="comp-title" style="color:${compColors[k]}">${compLabels[k]}</div>
<table class="comp-tbl"><tr><th style="width:80px">1í•™ë…„</th><td>${c.grade1||'-'}</td></tr>
<tr><th>2í•™ë…„</th><td>${c.grade2||'-'}</td></tr>
<tr><th style="color:${compColors[k]}">ì„±ì¥</th><td style="font-weight:600">${c.growth||'-'}</td></tr></table></div>`;
});
let jhHtml='';
[{k:'jayul',l:'ììœ¨í™œë™',lm:1500},{k:'jinro',l:'ì§„ë¡œí™œë™',lm:2100},{k:'dongari',l:'ë™ì•„ë¦¬í™œë™',lm:1500},{k:'hangbal',l:'í–‰ë™íŠ¹ì„±ë°ì¢…í•©ì˜ê²¬',lm:1500}].forEach(a=>{
const d=jh[a.k]||{},o1=d.option1||{},o2=d.option2||{},b1=bl(o1.text||''),b2=bl(o2.text||'');
jhHtml+=`<div class="section"><h3>${a.l} <span class="byte-tag">${a.lm}B</span></h3>
<p class="eval">${d.evaluation||''}</p>
<div class="opt-grid"><div class="opt-box">
<div class="opt-hdr"><span class="opt-badge blue">1ì•ˆ</span> ${o1.title||''} <span class="byte-count ${b1>a.lm?'over':''}">${b1}/${a.lm}B</span></div>
<div class="opt-body">${o1.text||''}</div>
<div class="opt-meta">âœ“ ${o1.focus||''} Â· â†’ ${o1.supplement||''}</div></div>
<div class="opt-box"><div class="opt-hdr"><span class="opt-badge purple">2ì•ˆ</span> ${o2.title||''} <span class="byte-count ${b2>a.lm?'over':''}">${b2}/${a.lm}B</span></div>
<div class="opt-body">${o2.text||''}</div>
<div class="opt-meta">âœ“ ${o2.focus||''} Â· â†’ ${o2.supplement||''}</div></div></div></div>`;
});
let seHtml=(se.subjects||[]).map(s=>`<div class="setuk-card"><div class="setuk-name">${s.name||''}</div>
<div class="setuk-theme">ğŸ“Œ ${s.theme||''}</div><div class="setuk-reason">${s.reason||''}</div>
<div class="setuk-kws">${(s.keywords||[]).map(k=>`<span class="kw-tag">${k}</span>`).join(' ')}</div></div>`).join('');
let clHtml=(cl.monthly||[]).map(m=>`<tr><td style="font-weight:700;color:#3182F6;width:60px">${m.month}</td><td>${m.activity||''}</td><td style="font-size:11px;color:#8B95A1">${m.record||''}</td></tr>`).join('');
let coHtml=`<div class="co-sec"><h4>ğŸ’¬ ìƒë‹´ í¬ì¸íŠ¸</h4>${(co.talk_points||[]).map(s=>`<p>â€¢ ${s}</p>`).join('')}</div>
<div class="co-sec"><h4>â“ ì§ˆë¬¸ ì˜ˆì‹œ</h4>${(co.questions||[]).map(s=>`<p>"${s}"</p>`).join('')}</div>
<div class="co-sec"><h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ í•™ë¶€ëª¨ ìƒë‹´</h4>${(co.parent_points||[]).map(s=>`<p>â€¢ ${s}</p>`).join('')}</div>
<div class="co-sec"><h4>ğŸš€ ì¶”ì²œ í™œë™</h4>${(co.recommended_activities||[]).map(s=>`<p>âœ¦ ${s}</p>`).join('')}</div>`;

return`<div class="info-bar">

<div class="info-item">ğŸ“‹ <span>${m.sid||''}</span> ${m.nm||''}</div>
<div class="info-item">ğŸ¯ ì§„ë¡œ: <span>${m.cr||''}</span></div>
<div class="info-item">ğŸ« ë™ì•„ë¦¬: <span>${m.cl||''}</span></div>
<div class="info-item">ğŸ“… <span>${m.dt||''}</span></div>
<div class="info-item">âš¡ <span>${(m.pri||[]).map((p,i)=>['â‘ ','â‘¡','â‘¢'][i]+p).join(' â†’ ')}</span></div>
</div>
<h2>ğŸ“Š ì¢…í•© ë¶„ì„</h2><div class="summary">${ov.summary||''}</div>
<div class="chips">${(ov.strengths||[]).map(s=>`<div class="chip-good">âœ¦ ${s}</div>`).join('')}</div>
<div class="chips">${(ov.improvements||[]).map(s=>`<div class="chip-imp">â†’ ${s}</div>`).join('')}</div>
<h2>ğŸ’ª 4ëŒ€ ì—­ëŸ‰ ë¶„ì„</h2>${compHtml}
<h2>ğŸ“ ììœ¨Â·ì§„ë¡œÂ·ë™ì•„ë¦¬Â·í–‰ë°œ ê¸°ì¬ ì˜ˆì‹œ</h2>${jhHtml}
<h2>ğŸ¯ 3í•™ë…„ ì„¸íŠ¹ ë°©í–¥</h2><div class="summary">${se.direction||''}</div>${seHtml}
<h2>ğŸ« ë™ì•„ë¦¬ ì›”ë³„ ê³„íš</h2><div class="summary">${cl.goal||''}</div>
<table class="club-tbl"><tr><th>ì›”</th><th>í™œë™ ë‚´ìš©</th><th>ê¸°ë¡ í¬ì¸íŠ¸</th></tr>${clHtml}</table>
<h2>ğŸ’¬ ìƒë‹´ ê°€ì´ë“œ</h2>${coHtml}
<div class="footer">ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ê¸° Â· AI Powered Â· ${m.dt||''}</div>`;
}

function dlPDF(){if(!cur)return;
const w=window.open(â€™â€™,â€™_blankâ€™);
const m=cur._m||{};
w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${m.nm||â€™â€™} ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ ë³´ê³ ì„œ</title>
${getPDFStyles()}</head><body>

<div class="cover"><h1>ğŸ“Š ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ ë³´ê³ ì„œ</h1><div class="sub">AI ê¸°ë°˜ í•™ìƒë¶€ ì¢…í•© ë¶„ì„ ë¦¬í¬íŠ¸</div></div>
${buildPDFContent(cur)}
</body></html>`);
w.document.close();setTimeout(()=>w.print(),800)}

function dlXL(){if(!cur||cur._err)return;const r=cur,m=r._m,jh=r.jarhaeng||{};
// SheetJSë¡œ ì—‘ì…€ ìƒì„±
const wb=XLSX.utils.book_new();
const areas=[{k:â€˜jayulâ€™,l:â€˜ììœ¨í™œë™â€™,lm:1500},{k:â€˜jinroâ€™,l:â€˜ì§„ë¡œí™œë™â€™,lm:2100},{k:â€˜dongariâ€™,l:â€˜ë™ì•„ë¦¬í™œë™â€™,lm:1500},{k:â€˜hangbalâ€™,l:â€˜í–‰ë™íŠ¹ì„±ë°ì¢…í•©ì˜ê²¬â€™,lm:1500}];

// ===== ì‹œíŠ¸1: í•™ìƒë³„ ìƒì„¸ (ì¢Œ: AIì˜ˆì‹œ / ìš°: êµì‚¬ê¸°ì…) =====
const s1=[];
// í—¤ë”
s1.push([â€˜ìƒê¸°ë¶€ ì„±ì¥ë¶„ì„ - ê°œì¸ë³„ ìƒë‹´ ê¸°ë¡ì§€â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™]);
s1.push([â€˜í•™êµëª…â€™,â€™â€™,â€˜í•™ë…„â€™,â€˜ë°˜â€™,â€˜ë²ˆí˜¸â€™,â€˜ì„±ëª…â€™,â€˜í¬ë§ì§„ë¡œâ€™]);
s1.push([â€™â€™,â€™â€™,(m.sid||â€™â€™).substring(0,1),(m.sid||â€™â€™).substring(1,3),(m.sid||â€™â€™).substring(3,5),m.nm,m.cr]);
s1.push([]);
s1.push([â€˜ì˜ì—­â€™,â€˜ë°”ì´íŠ¸ì œí•œâ€™,â€˜AI ìƒì„± ì˜ˆì‹œ (1ì•ˆ)â€™,â€˜Byteâ€™,â€˜AI ìƒì„± ì˜ˆì‹œ (2ì•ˆ)â€™,â€˜Byteâ€™,â€˜êµì‚¬ ì§ì ‘ ê¸°ì…ë€â€™,â€˜Byteâ€™]);

areas.forEach(a=>{
const d=jh[a.k]||{},o1=d.option1||{},o2=d.option2||{};
const t1=o1.text||â€™â€™,t2=o2.text||â€™â€™;
s1.push([a.l,a.lm,t1,bl(t1),t2,bl(t2),â€™â€™,0]);
});

s1.push([]);
s1.push([â€™â€» ì™¼ìª½ AI ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ì—¬ ì˜¤ë¥¸ìª½ êµì‚¬ ê¸°ì…ë€ì— ì§ì ‘ ì‘ì„±í•´ì£¼ì„¸ìš”.â€™]);
s1.push([â€™â€» ë°”ì´íŠ¸ ì œí•œì„ ì´ˆê³¼í•˜ë©´ í•´ë‹¹ ì…€ì˜ ë°”ì´íŠ¸ ìˆ˜ê°€ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.â€™]);
s1.push([â€™â€» ì´ ê³³ì— í•„ìš”í•œ ë‚´ìš©ì„ ì…ë ¥í•˜ê³  ë°˜ë“œì‹œ ì„ íƒí•œ í›„ ë³µì‚¬í•´ì„œ ê²€í† ìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤.â€™]);
s1.push([â€™â€» ì¶œë ¥ë¬¼ì— ë‚˜ì˜¤ê²Œ í•˜ê³  ì‹¶ì§€ ì•Šì€ ë¬¸ìë‚´ìš©ì€ ê¸€ììƒ‰ì„ ì¸ì‡„ë¡œ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤.â€™]);

const ws1=XLSX.utils.aoa_to_sheet(s1);

// ì»¬ëŸ¼ ë„ˆë¹„
ws1[â€™!colsâ€™]=[{wch:14},{wch:8},{wch:55},{wch:6},{wch:55},{wch:6},{wch:55},{wch:6}];

// ì…€ ìŠ¤íƒ€ì¼ë§ (SheetJS ë¬´ë£Œë²„ì „ í•œê³„ ë‚´ì—ì„œ)
// ë¨¸ì§€: íƒ€ì´í‹€
ws1[â€™!mergesâ€™]=[
{s:{r:0,c:0},e:{r:0,c:7}}, // íƒ€ì´í‹€
{s:{r:9,c:0},e:{r:9,c:7}}, // ì•ˆë‚´1
{s:{r:10,c:0},e:{r:10,c:7}}, // ì•ˆë‚´2
{s:{r:11,c:0},e:{r:11,c:7}}, // ì•ˆë‚´3
{s:{r:12,c:0},e:{r:12,c:7}}, // ì•ˆë‚´4
];

// í–‰ ë†’ì´ ì„¤ì • (ë°ì´í„° í–‰ì€ ë†’ê²Œ)
ws1[â€™!rowsâ€™]=[{hpt:30},{hpt:22},{hpt:22},{hpt:10},{hpt:22},{hpt:180},{hpt:200},{hpt:180},{hpt:180}];

XLSX.utils.book_append_sheet(wb,ws1,â€˜ê°œì¸ìƒë‹´â€™);

// ===== ì‹œíŠ¸2: ì „ì²´ í•™ìƒ ì¼ëŒí‘œ =====
const s2=[];
s2.push([â€˜ìƒê¸°ë¶€ ì „ì²´ í•™ìƒ ì¼ëŒí‘œ - êµì‚¬ìš©â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™]);
s2.push([â€˜ë²ˆí˜¸â€™,â€˜ì´ë¦„â€™,â€˜ììœ¨í™œë™ (1500B)â€™,â€˜Byteâ€™,â€˜ì§„ë¡œí™œë™ (2100B)â€™,â€˜Byteâ€™,â€˜ë™ì•„ë¦¬í™œë™ (1500B)â€™,â€˜Byteâ€™,â€˜í–‰ë°œ (1500B)â€™,â€˜Byteâ€™]);

// í˜„ì¬ í•™ìƒ ë°ì´í„° + ë‚˜ë¨¸ì§€ ë¹ˆ í–‰
const allStu=Object.values(stu).sort((a,b)=>a.sid.localeCompare(b.sid));
for(let i=1;i<=30;i++){
const num=String(i).padStart(2,â€˜0â€™);
const found=allStu.find(s=>s.sid&&s.sid.endsWith(num));
if(found&&found.result&&!found.result._err){
const fj=found.result.jarhaeng||{};
const ja=fj.jayul?.option1?.text||â€™â€™;
const ji=fj.jinro?.option1?.text||â€™â€™;
const dg=fj.dongari?.option1?.text||â€™â€™;
const hb=fj.hangbal?.option1?.text||â€™â€™;
s2.push([num,found.name||â€™â€™,ja,bl(ja),ji,bl(ji),dg,bl(dg),hb,bl(hb)]);
}else{
s2.push([num,â€™â€™,â€™â€™,0,â€™â€™,0,â€™â€™,0,â€™â€™,0]);
}
}

const ws2=XLSX.utils.aoa_to_sheet(s2);
ws2[â€™!colsâ€™]=[{wch:6},{wch:8},{wch:55},{wch:6},{wch:60},{wch:6},{wch:55},{wch:6},{wch:55},{wch:6}];
ws2[â€™!mergesâ€™]=[{s:{r:0,c:0},e:{r:0,c:9}}];
ws2[â€™!rowsâ€™]=[{hpt:28},{hpt:22},â€¦Array(30).fill({hpt:160})];

XLSX.utils.book_append_sheet(wb,ws2,â€˜ì „ì²´ì¼ëŒâ€™);

XLSX.writeFile(wb,`ìƒê¸°ë¶€_${m.sid}_${m.nm}.xlsx`)}

function dlAll(){if(!Object.keys(stu).length){alert(â€˜ë¶„ì„ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤â€™);return}
const wb=XLSX.utils.book_new();

// ì „ì²´ ì¼ëŒí‘œ
const s1=[];
s1.push([â€˜ìƒê¸°ë¶€ ì „ì²´ í•™ìƒ ì¼ëŒí‘œâ€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™]);
s1.push([â€˜ë²ˆí˜¸â€™,â€˜ì´ë¦„â€™,â€˜ì§„ë¡œâ€™,â€˜ììœ¨í™œë™ (1500B)â€™,â€˜Byteâ€™,â€˜ì§„ë¡œí™œë™ (2100B)â€™,â€˜Byteâ€™,â€˜ë™ì•„ë¦¬í™œë™ (1500B)â€™,â€˜Byteâ€™,â€˜í–‰ë°œ (1500B)â€™,â€˜Byteâ€™]);
const allStu=Object.values(stu).sort((a,b)=>a.sid.localeCompare(b.sid));
for(let i=1;i<=30;i++){
const num=String(i).padStart(2,â€˜0â€™);
const found=allStu.find(s=>s.sid&&s.sid.endsWith(num));
if(found&&found.result&&!found.result._err){
const fj=found.result.jarhaeng||{};
const ja=fj.jayul?.option1?.text||â€™â€™;
const ji=fj.jinro?.option1?.text||â€™â€™;
const dg=fj.dongari?.option1?.text||â€™â€™;
const hb=fj.hangbal?.option1?.text||â€™â€™;
s1.push([num,found.name||â€™â€™,found.career||â€™â€™,ja,bl(ja),ji,bl(ji),dg,bl(dg),hb,bl(hb)]);
}else{
s1.push([num,â€™â€™,â€™â€™,â€™â€™,0,â€™â€™,0,â€™â€™,0,â€™â€™,0]);
}
}
const ws1=XLSX.utils.aoa_to_sheet(s1);
ws1[â€™!colsâ€™]=[{wch:6},{wch:8},{wch:12},{wch:55},{wch:6},{wch:60},{wch:6},{wch:55},{wch:6},{wch:55},{wch:6}];
ws1[â€™!mergesâ€™]=[{s:{r:0,c:0},e:{r:0,c:10}}];
ws1[â€™!rowsâ€™]=[{hpt:28},{hpt:22},â€¦Array(30).fill({hpt:160})];
XLSX.utils.book_append_sheet(wb,ws1,â€˜ì „ì²´ì¼ëŒâ€™);

// ê°œë³„ í•™ìƒ ì‹œíŠ¸
allStu.forEach(s=>{
if(!s.result||s.result.*err)return;
const r=s.result,jh=r.jarhaeng||{};
const d=[[â€˜ìƒê¸°ë¶€ ê°œì¸ ìƒë‹´ ê¸°ë¡ - â€˜+s.sid+â€™ â€˜+s.name,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™,â€™â€™],
[â€˜ì˜ì—­â€™,â€˜ì œí•œâ€™,â€˜AI 1ì•ˆâ€™,â€˜Byteâ€™,â€˜AI 2ì•ˆâ€™,â€˜Byteâ€™,â€˜êµì‚¬ ê¸°ì…ë€â€™,â€˜Byteâ€™]];
[{k:â€˜jayulâ€™,l:â€˜ììœ¨í™œë™â€™,lm:1500},{k:â€˜jinroâ€™,l:â€˜ì§„ë¡œí™œë™â€™,lm:2100},{k:â€˜dongariâ€™,l:â€˜ë™ì•„ë¦¬í™œë™â€™,lm:1500},{k:â€˜hangbalâ€™,l:â€˜í–‰ë°œâ€™,lm:1500}].forEach(a=>{
const ar=jh[a.k]||{},o1=ar.option1||{},o2=ar.option2||{};
d.push([a.l,a.lm,o1.text||â€™â€™,bl(o1.text||â€™â€™),o2.text||â€™â€™,bl(o2.text||â€™â€™),â€™â€™,0]);
});
const ws=XLSX.utils.aoa_to_sheet(d);
ws[â€™!colsâ€™]=[{wch:14},{wch:6},{wch:55},{wch:6},{wch:55},{wch:6},{wch:55},{wch:6}];
ws[â€™!mergesâ€™]=[{s:{r:0,c:0},e:{r:0,c:7}}];
ws[â€™!rowsâ€™]=[{hpt:28},{hpt:22},{hpt:180},{hpt:200},{hpt:180},{hpt:180}];
const sheetName=(s.sid+â€™*â€™+s.name).substring(0,31);
XLSX.utils.book_append_sheet(wb,ws,sheetName);
});

XLSX.writeFile(wb,â€˜ìƒê¸°ë¶€_ì „ì²´.xlsxâ€™)}

function rStu(){const l=document.getElementById(â€˜stuLâ€™),e=Object.values(stu).sort((a,b)=>a.sid.localeCompare(b.sid));
document.getElementById(â€˜stuCntâ€™).textContent=e.length+â€˜ëª… ì™„ë£Œâ€™;
if(!e.length){l.innerHTML=â€™<div style="padding:20px;color:var(--g4);text-align:center;font-size:14px">ì•„ì§ ë¶„ì„ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</div>â€™;return}
l.innerHTML=e.map(s=>`<div class="si" style="cursor:pointer" onclick="viewStudent('${s.sid}')"> <span><span class="num">${s.sid}</span><strong>${s.name}</strong></span> <span style="display:flex;align-items:center;gap:8px"> <span class="meta">${s.career} Â· ${s.date}</span> <button class="btn btn-sm" style="padding:4px 10px;font-size:11px;background:var(--green-bg);color:var(--green);border:none;border-radius:6px;cursor:pointer" onclick="event.stopPropagation();dlStudentPDF('${s.sid}')">PDF</button> </span></div>`).join(â€™â€™)}

function next(){
document.getElementById(â€˜resSâ€™).style.display=â€˜noneâ€™;
document.getElementById(â€˜resContentâ€™).innerHTML=â€™â€™;
cur=null;
[â€˜sNameâ€™,â€˜sCareerâ€™,â€˜sClubâ€™,â€˜memoâ€™].forEach(id=>document.getElementById(id).value=â€™â€™);
pdf=â€™â€™;const d=document.getElementById(â€˜dzâ€™);d.classList.remove(â€˜doneâ€™);d.querySelector(â€™.dz-iâ€™).textContent=â€˜ğŸ“„â€™;
d.querySelector(â€™.dz-mâ€™).textContent=â€˜PDF íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸â€™;const ds=d.querySelector(â€™.dz-sâ€™);if(ds)ds.style.display=â€˜noneâ€™;
document.getElementById(â€˜fIâ€™).classList.add(â€˜hiddenâ€™);document.getElementById(â€˜fiâ€™).value=â€™â€™;
// ë²ˆí˜¸ ìë™ +1
const curNo=parseInt(document.getElementById(â€˜sNoâ€™).value)||0;
if(curNo<30)document.getElementById(â€˜sNoâ€™).value=String(curNo+1).padStart(2,â€˜0â€™);
updPreview();chk();window.scrollTo({top:0,behavior:â€˜smoothâ€™})}
</script>

</body>
</html>